function module(e,t,n){let a,o,l,c,r,s,i,u,m,d,_,f,E,y,h,p,k,C,x,g,b,w,v,T;n.link("@babel/runtime/helpers/extends",{default(e){a=e}},0),n.link("@babel/runtime/helpers/objectWithoutProperties",{default(e){o=e}},1),n.link("react",{default(e){l=e},useState(e){c=e},useCallback(e){r=e},useEffect(e){s=e},useRef(e){i=e},useMemo(e){u=e}},0),n.link("@rocket.chat/fuselage",{Box(e){m=e},Button(e){d=e},TextInput(e){_=e},Icon(e){f=e},ButtonGroup(e){E=e},Margins(e){y=e},Modal(e){h=e}},1),n.link("@rocket.chat/fuselage-hooks",{useSafely(e){p=e}},2),n.link("yaqrcode",{default(e){k=e}},3),n.link("../../contexts/UserContext",{useUser(e){C=e}},4),n.link("../../contexts/ToastMessagesContext",{useToastMessageDispatch(e){x=e}},5),n.link("../../contexts/ModalContext",{useSetModal(e){g=e}},6),n.link("../../contexts/TranslationContext",{useTranslation(e){b=e}},7),n.link("../../hooks/useForm",{useForm(e){w=e}},8),n.link("../../contexts/ServerContext",{useMethod(e){v=e}},9),n.link("../../components/basic/TextCopy",{default(e){T=e}},10);const M=e=>{let{codes:t,onClose:n}=e,a=o(e,["codes","onClose"]);const c=b(),r=u(()=>t.join(" "),[t]);return l.createElement(h,a,l.createElement(h.Header,null,l.createElement(f,{name:"info",size:20}),l.createElement(h.Title,null,c("Backup_codes")),l.createElement(h.Close,{onClick:n})),l.createElement(h.Content,{fontScale:"p1"},l.createElement(m,{mb:"x8",withRichContent:!0},c("Make_sure_you_have_a_copy_of_your_codes_1")),l.createElement(T,{text:r,wordBreak:"break-word",mb:"x8"}),l.createElement(m,{mb:"x8",withRichContent:!0},c("Make_sure_you_have_a_copy_of_your_codes_2"))),l.createElement(h.Footer,null,l.createElement(E,{align:"end"},l.createElement(d,{primary:!0,onClick:n},c("Ok")))))},S=e=>{let{onVerify:t,onCancel:n}=e,a=o(e,["onVerify","onCancel"]);const c=b(),u=i();s(()=>{var e;"function"==typeof(null==u?void 0:null===(e=u.current)||void 0===e?void 0:e.focus)&&u.current.focus()},[u]);const{values:y,handlers:p}=w({code:""}),{code:k}=y,{handleCode:C}=p,x=r(e=>{("click"===e.type||"keydown"===e.type&&13===e.keyCode)&&t(k)},[k,t]);return l.createElement(h,a,l.createElement(h.Header,null,l.createElement(f,{name:"info",size:20}),l.createElement(h.Title,null,c("Two-factor_authentication")),l.createElement(h.Close,{onClick:n})),l.createElement(h.Content,{fontScale:"p1"},l.createElement(m,{mbe:"x8"},c("Open_your_authentication_app_and_enter_the_code")),l.createElement(m,{display:"flex",alignItems:"stretch"},l.createElement(_,{ref:u,placeholder:c("Enter_authentication_code"),value:k,onChange:C,onKeyDown:x}))),l.createElement(h.Footer,null,l.createElement(E,{align:"end"},l.createElement(d,{onClick:n},c("Cancel")),l.createElement(d,{primary:!0,onClick:x},c("Verify")))))},F=e=>{const t=b(),n=x(),o=C(),i=g(),u=v("2fa:enable"),f=v("2fa:disable"),E=v("2fa:validateTempToken"),h=v("2fa:checkCodesRemaining"),F=v("2fa:regenerateCodes"),[I,R]=p(c(!1)),[B,D]=p(c()),[V,z]=p(c()),[j,H]=p(c()),{values:O,handlers:Q}=w({authCode:""}),{authCode:U}=O,{handleAuthCode:q}=Q,A=o&&o.services&&o.services.totp&&o.services.totp.enabled,G=r(()=>i(null),[i]);s(()=>{const e=async()=>{if(!A)return!1;const e=await h();H(e.remaining)};e()},[h,H,A]);const K=r(async()=>{try{const e=await u();z(e.secret),D(k(e.url,{size:200})),R(!0)}catch(e){n({type:"error",message:e})}},[n,u,D,R,z]),P=r(async()=>{const e=async e=>{try{const a=await f(e);if(!a)return n({type:"error",message:t("Invalid_two_factor_code")});n({type:"success",message:t("Two-factor_authentication_disabled")})}catch(a){n({type:"error",message:a})}G()};i(l.createElement(S,{onVerify:e,onCancel:G}))},[G,f,n,i,t]),W=r(async()=>{try{const e=await E(U);if(!e)return n({type:"error",message:t("Invalid_two_factor_code")});i(l.createElement(M,{codes:e.codes,onClose:G}))}catch(e){n({type:"error",message:e})}},[U,G,n,i,t,E]),Y=r(()=>{const e=async e=>{try{const a=await F(e);if(!a)return n({type:"error",message:t("Invalid_two_factor_code")});i(l.createElement(M,{codes:a.codes,onClose:G}))}catch(a){n({type:"error",message:a})}};i(l.createElement(S,{onVerify:e,onCancel:G}))},[G,n,F,i,t]);return l.createElement(m,a({display:"flex",flexDirection:"column",alignItems:"flex-start"},e),l.createElement(y,{blockEnd:"x8"},l.createElement(m,{fontScale:"s2"},t("Two-factor_authentication")),!A&&!I&&l.createElement(l.Fragment,null,l.createElement(m,null,t("Two-factor_authentication_is_currently_disabled")),l.createElement(d,{primary:!0,onClick:K},t("Enable_two-factor_authentication"))),!A&&I&&l.createElement(l.Fragment,null,l.createElement(m,null,t("Scan_QR_code")),l.createElement(m,null,t("Scan_QR_code_alternative_s")),l.createElement(T,{text:V}),l.createElement(m,{is:"img",size:"x200",src:B,"aria-hidden":"true"}),l.createElement(m,{display:"flex",flexDirection:"row",w:"full"},l.createElement(_,{placeholder:t("Enter_authentication_code"),value:U,onChange:q}),l.createElement(d,{primary:!0,onClick:W},t("Verify")))),A&&l.createElement(l.Fragment,null,l.createElement(d,{primary:!0,danger:!0,onClick:P},t("Disable_two-factor_authentication")),l.createElement(m,{fontScale:"p2",mbs:"x8"},t("Backup_codes")),l.createElement(m,null,t("You_have_n_codes_remaining",{number:j})),l.createElement(d,{onClick:Y},t("Regenerate_codes")))))};n.exportDefault(F)}

