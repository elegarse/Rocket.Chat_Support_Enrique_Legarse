function module(e,t,n){let r,a,s,i,l,o,c,d,p;n.link("@babel/runtime/helpers/objectSpread2",{default(e){r=e}},0),n.export({AppDataContext:()=>u}),n.link("react",{default(e){a=e},createContext(e){s=e},useEffect(e){i=e},useRef(e){l=e},useState(e){o=e}},0),n.link("../../../app/apps/client/orchestrator",{Apps(e){c=e}},1),n.link("../../../app/apps/client/communication",{AppEvents(e){d=e}},2),n.link("./helpers",{handleAPIError(e){p=e}},3);const u=s({data:[],dataCache:[],finishedLoading:!1}),f=e=>{const t=Object.entries(e);for(const[r,a]of t){var n;null===(n=c.getWsListener())||void 0===n||n.registerListener(d[r],a)}return()=>{for(const[n,r]of t){var e;null===(e=c.getWsListener())||void 0===e||e.unregisterListener(d[n],r)}}},v=e=>{let{children:t}=e;const[n,s]=o(()=>[]),[d,v]=o(()=>!1),[A,h]=o(()=>[]),m=l(n);m.current=n;const P=()=>{h(()=>[])},g=()=>m.current.slice(0);return i(()=>{const e=e=>{s(e.sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1)),P()},t=async e=>{try{const{status:t,version:n}=await c.getApp(e),a=await c.getAppFromMarketplace(e,n),i=g(),l=i.findIndex(t=>{let{id:n}=t;return n===e});i[l]=r({},a,{installed:!0,status:t,version:n,marketplaceVersion:a.version}),s(i),P()}catch(t){p(t)}},n={APP_ADDED:t,APP_UPDATED:t,APP_REMOVED:e=>{const t=g(),n=t.findIndex(t=>{let{id:n}=t;return n===e});t[n]&&(!1!==t[n].marketplace?t.splice(n,1):(delete t[n].installed,delete t[n].status,t[n].version=t[n].marketplaceVersion),s(t),P())},APP_STATUS_CHANGE:e=>{let{appId:t,status:n}=e;const r=g(),a=r.find(e=>{let{id:n}=e;return n===t});a&&(a.status=n,s(r),P())},APP_SETTING_UPDATED:()=>{P()}},a=f(n);return(async()=>{try{const t=await c.getApps().then(t=>{let n=[];return t.length&&(n=t.map(e=>r({},e,{installed:!0,marketplace:!1})),e(n)),n}),n=await c.getAppsFromMarketplace(),a=n.length?n.map(e=>{const n=t.findIndex(t=>{let{id:n}=t;return n===e.id});if(!t[n])return r({},e,{status:void 0,marketplaceVersion:e.version,bundledIn:e.bundledIn});const a=t.splice(n,1).pop();return r({},e,{installed:!0,status:null==a?void 0:a.status,version:null==a?void 0:a.version,bundledIn:e.bundledIn,marketplaceVersion:e.version})}):[];t.length&&a.push(...t),e(a),v(!0)}catch(t){p(t),a()}})(),a},[s,v]),a.createElement(u.Provider,{children:t,value:{data:n,dataCache:A,finishedLoading:d}})};n.exportDefault(v)}

