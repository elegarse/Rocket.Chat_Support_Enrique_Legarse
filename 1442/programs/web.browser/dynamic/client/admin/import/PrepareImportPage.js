function module(e,t,n){let r,a,l,s,o,i,m,c,u,d,p,h,E,g,_,C,k,f,I,S,P,b,w,x,v,T,y,F,R,B,D,L,M;n.link("@babel/runtime/helpers/objectSpread2",{default(e){r=e}},0),n.link("@rocket.chat/fuselage",{Badge(e){a=e},Box(e){l=e},Button(e){s=e},ButtonGroup(e){o=e},CheckBox(e){i=e},Icon(e){m=e},Margins(e){c=e},Table(e){u=e},Tag(e){d=e},Throbber(e){p=e},Pagination(e){h=e},Tabs(e){E=e}},0),n.link("@rocket.chat/fuselage-hooks",{useDebouncedValue(e){g=e},useSafely(e){_=e}},1),n.link("react",{default(e){C=e},useEffect(e){k=e},useState(e){f=e},useMemo(e){I=e},useCallback(e){S=e}},2),n.link("underscore.string",{default(e){P=e}},3),n.link("meteor/meteor",{Meteor(e){b=e}},4),n.link("../../components/basic/Page",{default(e){w=e}},5),n.link("../../contexts/TranslationContext",{useTranslation(e){x=e}},6),n.link("../../../app/importer/lib/ImporterProgressStep",{ProgressStep(e){v=e},ImportWaitingStates(e){T=e},ImportFileReadyStates(e){y=e},ImportPreparingStartedStates(e){F=e},ImportingStartedStates(e){R=e},ImportingErrorStates(e){B=e}},7),n.link("./useErrorHandler",{useErrorHandler(e){D=e}},8),n.link("../../contexts/RouterContext",{useRoute(e){L=e}},9),n.link("../../contexts/ServerContext",{useEndpoint(e){M=e}},10);const U=(e,t)=>new Promise((n,r)=>{const a=()=>{e().then(e=>{t(e)?n(e):setTimeout(a,1e3)},r)};a()});function H(e){let{usersCount:t,users:n,setUsers:a}=e;const l=x(),[s,o]=f(0),[m,c]=f(25),p=S(e=>{let{count:t,current:n,itemsPerPage:r}=e;return l("Showing results %s - %s of %s",n+1,Math.min(n+r,t),t)},[l]),E=S(()=>l("Items_per_page:"),[l]);return C.createElement(C.Fragment,null,C.createElement(u,null,C.createElement(u.Head,null,C.createElement(u.Row,null,C.createElement(u.Cell,{width:"x36"},C.createElement(i,{checked:t>0,indeterminate:t>0&&t!==n.length,onChange:()=>{a(e=>{const n=e.some(e=>{let{is_deleted:t,do_import:n}=e;return t&&n}),a=0===t;return a?e.map(e=>r({},e,{do_import:!0})):n?e.map(e=>e.is_deleted?r({},e,{do_import:!1}):e):e.map(e=>r({},e,{do_import:!1}))})}})),C.createElement(u.Cell,{is:"th"},l("Username")),C.createElement(u.Cell,{is:"th"},l("Email")),C.createElement(u.Cell,{is:"th"}))),C.createElement(u.Body,null,n.slice(s,s+m).map(e=>C.createElement(u.Row,{key:e.user_id},C.createElement(u.Cell,{width:"x36"},C.createElement(i,{checked:e.do_import,onChange:t=>{const{checked:n}=t.currentTarget;a(t=>t.map(t=>t===e?r({},t,{do_import:n}):t))}})),C.createElement(u.Cell,null,e.username),C.createElement(u.Cell,null,e.email),C.createElement(u.Cell,{align:"end"},e.is_deleted&&C.createElement(d,{variant:"danger"},l("Deleted"))))))),C.createElement(h,{current:s,itemsPerPage:m,count:n.length||0,onSetItemsPerPage:c,onSetCurrent:o,itemsPerPageLabel:E,showingResultsLabel:p}))}function O(e){let{channels:t,channelsCount:n,setChannels:a}=e;const l=x(),[s,o]=f(0),[m,c]=f(25),p=S(e=>{let{count:t,current:n,itemsPerPage:r}=e;return l("Showing results %s - %s of %s",n+1,Math.min(n+r,t),t)},[l]),E=S(()=>l("Items_per_page:"),[l]);return t.length&&C.createElement(C.Fragment,null,C.createElement(u,null,C.createElement(u.Head,null,C.createElement(u.Row,null,C.createElement(u.Cell,{width:"x36"},C.createElement(i,{checked:n>0,indeterminate:n>0&&n!==t.length,onChange:()=>{a(e=>{const t=e.some(e=>{let{is_archived:t,do_import:n}=e;return t&&n}),a=0===n;return a?e.map(e=>r({},e,{do_import:!0})):t?e.map(e=>e.is_archived?r({},e,{do_import:!1}):e):e.map(e=>r({},e,{do_import:!1}))})}})),C.createElement(u.Cell,{is:"th"},l("Name")),C.createElement(u.Cell,{is:"th",align:"end"}))),C.createElement(u.Body,null,t.slice(s,s+m).map(e=>C.createElement(u.Row,{key:e.channel_id},C.createElement(u.Cell,{width:"x36"},C.createElement(i,{checked:e.do_import,onChange:t=>{const{checked:n}=t.currentTarget;a(t=>t.map(t=>t===e?r({},t,{do_import:n}):t))}})),C.createElement(u.Cell,null,e.name),C.createElement(u.Cell,{align:"end"},e.is_archived&&C.createElement(d,{variant:"danger"},l("Importer_Archived"))))))),C.createElement(h,{current:s,itemsPerPage:m,itemsPerPageLabel:E,showingResultsLabel:p,count:t.length||0,onSetItemsPerPage:c,onSetCurrent:o}))}function j(){const e=x(),t=D(),[n,i]=_(f(!0)),[u,d]=_(f(null)),[h,S]=_(f(null)),[j,G]=_(f(0)),[N,W]=f([]),[A,V]=f([]),[q,z]=_(f(!1)),J=I(()=>N.filter(e=>{let{do_import:t}=e;return t}).length,[N]),K=I(()=>A.filter(e=>{let{do_import:t}=e;return t}).length,[A]),Q=L("admin-import"),X=L("admin-import-new"),Y=L("admin-import-progress"),Z=M("GET","getImportFileData"),$=M("GET","getCurrentImportOperation"),ee=M("POST","startImport");k(()=>{const e=new b.Streamer("importers"),t=e=>{let{rate:t}=e;d(t)};return e.on("progress",t),()=>{e.removeListener("progress",t)}},[d]),k(()=>{const n=async()=>{try{const n=await U(Z,e=>e&&!e.waiting);if(!n)return t(e("Importer_not_setup")),void Q.push();if(n.step)return t(e("Failed_To_Load_Import_Data")),void Q.push();G(n.message_count),W(n.users.map(e=>r({},e,{do_import:!0}))),V(n.channels.map(e=>r({},e,{do_import:!0}))),i(!1),d(null)}catch(n){t(n,e("Failed_To_Load_Import_Data")),Q.push()}},a=async()=>{try{const{operation:r}=await U($,e=>{let{operation:t}=e;return t.valid&&!T.includes(t.status)});if(!r.valid)return void X.push();if(R.includes(r.status))return void Y.push();if(r.status===v.USER_SELECTION||F.includes(r.status)||y.includes(r.status))return S(r.status),void n();if(B.includes(r.status))return t(e("Import_Operation_Failed")),void Q.push();if(r.status===v.DONE)return void Q.push();t(e("Unknown_Import_State")),Q.push()}catch(r){t(e("Failed_To_Load_Import_Data")),Q.push()}};a()},[$,Z,t,Q,Y,X,G,i,d,S,e]);const te=()=>{Q.push()},ne=async()=>{z(!0);try{await ee({input:{users:N,channels:A}}),Y.push()}catch(n){t(n,e("Failed_To_Start_Import")),Q.push()}},[re,ae]=f("users"),le=I(()=>e=>()=>ae(e),[]),se=g(h,100);return C.createElement(w,null,C.createElement(w.Header,{title:e("Importing_Data")},C.createElement(o,null,C.createElement(s,{ghost:!0,onClick:te},C.createElement(m,{name:"back"})," ",e("Back_to_imports")),C.createElement(s,{primary:!0,disabled:q,onClick:ne},e("Importer_Prepare_Start_Import")))),C.createElement(w.ScrollableContentWithShadow,null,C.createElement(l,{marginInline:"auto",marginBlock:"x24",width:"full",maxWidth:"590px"},C.createElement(l,{is:"h2",fontScale:"p2"},se&&e(se.replace("importer_","importer_status_"))),!n&&C.createElement(E,{flexShrink:0},C.createElement(E.Item,{disabled:0===J,selected:"users"===re,onClick:le("users")},e("Users")," ",C.createElement(a,{is:"span"},J)),C.createElement(E.Item,{selected:"channels"===re,onClick:le("channels")},e("Channels")," ",C.createElement(a,{is:"span"},K)),C.createElement(E.Item,{disabled:!0},e("Messages"),C.createElement(a,{is:"span"},j))),C.createElement(c,{block:"x24"},n&&C.createElement(C.Fragment,null,u?C.createElement(l,{display:"flex",justifyContent:"center",fontScale:"p1"},C.createElement(l,{is:"progress",value:(10*u).toFixed(0),max:"1000",marginInlineEnd:"x24"}),C.createElement(l,{is:"span"},P.numberFormat(u,0),"%")):C.createElement(p,{justifyContent:"center"})),!n&&"users"===re&&C.createElement(H,{usersCount:J,users:N,setUsers:W}),!n&&"channels"===re&&C.createElement(O,{channels:A,channelsCount:K,setChannels:V})))))}n.exportDefault(j)}

