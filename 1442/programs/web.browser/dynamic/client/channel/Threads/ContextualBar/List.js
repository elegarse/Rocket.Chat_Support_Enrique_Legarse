function module(e,t,n){let r,i,l,a,o,s,u,d,c,m,p,f,g,h,k,x,E,_,b,T,w,S,C,I,D,M,y,v,U,z,R,B,G,L,N,A,O,P,F,H,$,j;function V(e){return t=>{let{msg:n,username:r,replies:a,tcount:o,ts:s}=t,d=l(t,["msg","username","replies","tcount","ts"]);return(u.createElement(e,i({replies:o,participants:a.length,username:r,msg:n,ts:s},d)))}}n.link("@babel/runtime/helpers/objectSpread2",{default(e){r=e}},0),n.link("@babel/runtime/helpers/extends",{default(e){i=e}},1),n.link("@babel/runtime/helpers/objectWithoutProperties",{default(e){l=e}},2),n.export({withData:()=>Y,normalizeThreadMessage:()=>ee,ThreadList:()=>te}),n.link("meteor/mongo",{Mongo(e){a=e}},0),n.link("meteor/tracker",{Tracker(e){o=e}},1),n.link("underscore.string",{default(e){s=e}},2),n.link("react",{default(e){u=e},useCallback(e){d=e},useMemo(e){c=e},useState(e){m=e},useEffect(e){p=e},useRef(e){f=e}},3),n.link("@rocket.chat/fuselage",{Box(e){g=e},Icon(e){h=e},TextInput(e){k=e},Select(e){x=e},Margins(e){E=e},Callout(e){_=e}},4),n.link("react-window",{FixedSizeList(e){b=e}},5),n.link("react-window-infinite-loader",{default(e){T=e}},6),n.link("@rocket.chat/fuselage-hooks",{useDebouncedValue(e){w=e},useDebouncedState(e){S=e},useResizeObserver(e){C=e},useLocalStorage(e){I=e}},7),n.link("../../../components/basic/VerticalBar",{default(e){D=e}},8),n.link("../../../contexts/TranslationContext",{useTranslation(e){M=e}},9),n.link("../../../contexts/RouterContext",{useRoute(e){y=e},useCurrentRoute(e){v=e}},10),n.link("../../../../app/ui-utils/client",{call(e){U=e},renderMessageBody(e){z=e}},11),n.link("../../../contexts/UserContext",{useUserId(e){R=e},useUserSubscription(e){B=e}},12),n.link("../../../../app/models/client",{Messages(e){G=e}},13),n.link("../../../hooks/useEndpointDataExperimental",{useEndpointDataExperimental(e){L=e},ENDPOINT_STATES(e){N=e}},14),n.link("../../hooks/useUserRoom",{useUserRoom(e){A=e}},15),n.link("../../../contexts/SettingsContext",{useSetting(e){O=e}},16),n.link("../../../hooks/useTimeAgo",{useTimeAgo(e){P=e}},17),n.link("../../helpers/clickableItem",{clickableItem(e){F=e}},18),n.link("../../components/Message",{MessageSkeleton(e){H=e}},19),n.link("./components/Message",{default(e){$=e}},20),n.link("../../../../app/ui-utils/client/config",{getConfig(e){j=e}},21);const W=u.memo(V(F($))),q=u.memo(F(H)),J=parseInt(j("threadsListSize"))||25,K=e=>{let{msg:t,u:n,replies:i,mentions:l,tcount:a,ts:o,_id:s,tlm:u,attachments:d}=e;return r({},s&&{_id:s},{attachments:d,mentions:l,msg:t,u:n,replies:i,tcount:a,ts:new Date(o),tlm:new Date(u)})},Q={tunread:1,tunreadUser:1,tunreadGroup:1},X={t:1,name:1};function Y(e){return t=>{let{rid:n}=t,s=l(t,["rid"]);const g=A(n,X),h=B(n,Q),k=R(),[x,E]=I("thread-list-type","all"),[_,b]=m(""),[T,C]=m(J),[D,M]=S([],100),y=f(new a.Collection(null)),v=f(),[U,z]=m({skip:0,count:J}),O=c(()=>({rid:g._id,count:U.count,offset:U.skip,type:x,text:_}),[g._id,U.skip,U.count,x,_]),{data:P,state:F,error:H}=L("chat.getThreadsList",w(O,400)),$=d((e,t)=>(z({skip:e,count:t-e}),new Promise(e=>{v.current=e})),[]);p(()=>()=>y.current.remove({},()=>{}),[_,x]),p(()=>{F===N.DONE&&P&&P.threads&&(P.threads.forEach(e=>{let{_id:t}=e,n=l(e,["_id"]);y.current.upsert({_id:t},K(n))}),v.current&&v.current(),C(P.total))},[P,F]),p(()=>{const e=G.find({rid:g._id,tcount:{$exists:!0},_hidden:{$ne:!0}}).observe({added:e=>{let{_id:t}=e,n=l(e,["_id"]);y.current.upsert({_id:t},n)},changed:e=>{let{_id:t}=e,n=l(e,["_id"]);y.current.update({_id:t},n)},removed:e=>{let{_id:t}=e;y.current.remove(t)}});return()=>e.stop()},[g._id]),p(()=>{const e=o.autorun(()=>{const e=r({},"subscribed"===x&&{replies:{$in:[k]}});M(y.current.find(e,{sort:{tlm:-1}}).fetch().map(K))});return()=>e.stop()},[g._id,x,M,k]);const j=d(e=>{z({skip:0,count:J}),b(e.currentTarget.value)},[]);return(u.createElement(e,i({},s,{unread:null==h?void 0:h.tunread,unreadUser:null==h?void 0:h.tunreadUser,unreadGroup:null==h?void 0:h.tunreadGroup,userId:k,error:H,threads:D,total:T,loading:F===N.LOADING,loadMoreItems:$,room:g,text:_,setText:j,type:x,setType:E})))}}const Z=e=>{e.preventDefault(),e.stopPropagation(),U([!0,"true"].includes(e.currentTarget.dataset.following)?"unfollowMessage":"followMessage",{mid:e.currentTarget.dataset.id})},ee=e=>{let t=i({},e);if(t.msg)return z(t).replace(/<br\s?\\?>/g," ");if(t.attachments){const e=t.attachments.find(e=>e.title||e.description);if(e&&e.description)return s.escapeHTML(e.description);if(e&&e.title)return s.escapeHTML(e.title)}};function te(e){let{total:t=10,threads:n=[],room:r,unread:l=[],unreadUser:a=[],unreadGroup:o=[],type:s,setType:m,loadMoreItems:p,loading:w,onClose:S,error:I,userId:U,text:z,setText:R}=e;const B=O("UI_Use_Real_Name"),G=f(),L=M(),[N]=v(),A=y(N),F=d(e=>{const{id:t}=e.currentTarget.dataset;A.push({tab:"thread",context:t,rid:r._id,name:r.name})},[r._id,r.name]),H=P(),$=c(()=>[["all",L("All")],["following",L("Following")],["unread",L("Unread")]],[]);G.current=n;const j=d(u.memo((function e(t){let{data:n,index:r,style:s}=t;if(!n[r])return u.createElement(q,{style:s});const d=n[r],c=ee(d),{name:m=d.u.username}=d.u;return u.createElement(W,i({},d,{name:B?m:d.u.username,username:d.u.username,style:s,unread:l.includes(d._id),mention:a.includes(d._id),all:o.includes(d._id),following:d.replies&&d.replies.includes(U),"data-id":d._id,msg:c,t:L,formatDate:H,handleFollowButton:Z,onClick:F}))})),[l,a,o,B]),V=d(e=>e<G.current.length,[]),{ref:K,contentBoxSize:{inlineSize:Q=378,blockSize:X=750}={}}=C({debounceDelay:100});return u.createElement(D,null,u.createElement(D.Header,null,u.createElement(h,{name:"thread",size:"x20"}),u.createElement(g,{flexShrink:1,flexGrow:1,withTruncatedText:!0,mi:"x8"},L("Threads")),u.createElement(D.Close,{onClick:S})),u.createElement(D.Content,{paddingInline:0},u.createElement(g,{display:"flex",flexDirection:"row",p:"x24",borderBlockEndWidth:"x2",borderBlockEndStyle:"solid",borderBlockEndColor:"neutral-200",flexShrink:0},u.createElement(g,{display:"flex",flexDirection:"row",flexGrow:1,mi:"neg-x8"},u.createElement(E,{inline:"x8"},u.createElement(k,{placeholder:L("Search_Messages"),value:z,onChange:R,addon:u.createElement(h,{name:"magnifier",size:"x20"})}),u.createElement(x,{flexGrow:0,width:"110px",onChange:m,value:s,options:$})))),u.createElement(g,{flexGrow:1,flexShrink:1,ref:K},I&&u.createElement(_,{mi:"x24",type:"danger"},I.toString()),0===t&&u.createElement(g,{p:"x24"},L("No_Threads")),u.createElement(T,{isItemLoaded:V,itemCount:t,loadMoreItems:w?()=>{}:p},e=>{let{onItemsRendered:r,ref:i}=e;return(u.createElement(b,{height:X,width:Q,itemCount:t,itemData:n,itemSize:124,ref:i,minimumBatchSize:J,onItemsRendered:r},j))}))))}n.exportDefault(Y(te))}

