function module(e,t,a){let n,s,i,r,o,l,c,v,g,m,u,p,h,d;a.link("@babel/runtime/helpers/objectSpread2",{default(e){n=e}},0),a.link("meteor/meteor",{Meteor(e){s=e}},0),a.link("meteor/reactive-var",{ReactiveVar(e){i=e}},1),a.link("meteor/tracker",{Tracker(e){r=e}},2),a.link("meteor/templating",{Template(e){o=e}},3),a.link("moment",{default(e){l=e}},4),a.link("../../../../../utils",{handleError(e){c=e}},5),a.link("../../../../../ui-utils",{popover(e){v=e}},6),a.link("../../../lib/chartHandler",{drawLineChart(e){g=e}},7),a.link("../../../lib/dateHandler",{setDateRange(e){m=e},updateDateRange(e){u=e}},8),a.link("../../../../../utils/client",{APIClient(e){p=e}},9),a.link("./livechatAnalytics.html");const _=()=>[{name:"Conversations",value:"conversations",chartOptions:[{name:"Total_conversations",value:"total-conversations"},{name:"Avg_chat_duration",value:"avg-chat-duration"},{name:"Total_messages",value:"total-messages"}]},{name:"Productivity",value:"productivity",chartOptions:[{name:"Avg_first_response_time",value:"avg-first-response-time"},{name:"Best_first_response_time",value:"best_first_response_time"},{name:"Avg_response_time",value:"avg-response-time"},{name:"Avg_reaction_time",value:"avg-reaction-time"}]}],D=(e,t)=>{const a=[];for(;e.length;){const n=Math.ceil(e.length/t--),s=e.slice(0,n);a.push(s),e=e.slice(n)}return a},O=e=>null==e?void 0:e._id,f=()=>{const[e]=h.selectedDepartments.get(),t=O(e),a=n({daterange:{from:l(h.daterange.get().from,"MMM D YYYY").toISOString(),to:l(h.daterange.get().to,"MMM D YYYY").toISOString()},chartOptions:h.chartOptions.get()},t&&{departmentId:t});s.call("livechat:getAnalyticsChartData",a,(async function(e,t){if(e)return c(e);t&&t.chartLabel&&t.dataLabels&&t.dataPoints||console.log("livechat:getAnalyticsChartData => Missing Data"),d=await g(document.getElementById("lc-analytics-chart"),d,[t.chartLabel],t.dataLabels,[t.dataPoints])})),s.call("livechat:getAgentOverviewData",a,(function(e,t){if(e)return c(e);t||console.log("livechat:getAgentOverviewData => Missing Data"),h.agentOverviewData.set(t)}))},y=()=>{const[e]=h.selectedDepartments.get(),t=O(e),a=n({daterange:{from:l(h.daterange.get().from,"MMM D YYYY").toISOString(),to:l(h.daterange.get().to,"MMM D YYYY").toISOString()},analyticsOptions:h.analyticsOptions.get()},t&&{departmentId:t});s.call("livechat:getAnalyticsOverviewData",a,(e,t)=>{if(e)return c(e);t||console.log("livechat:getAnalyticsOverviewData => Missing Data"),h.analyticsOverviewData.set(D(t,3))})};o.livechatAnalytics.helpers({analyticsOverviewData:()=>h.analyticsOverviewData.get(),agentOverviewData:()=>h.agentOverviewData.get(),analyticsAllOptions:()=>[{name:"Conversations",value:"conversations",chartOptions:[{name:"Total_conversations",value:"total-conversations"},{name:"Avg_chat_duration",value:"avg-chat-duration"},{name:"Total_messages",value:"total-messages"}]},{name:"Productivity",value:"productivity",chartOptions:[{name:"Avg_first_response_time",value:"avg-first-response-time"},{name:"Best_first_response_time",value:"best_first_response_time"},{name:"Avg_response_time",value:"avg-response-time"},{name:"Avg_reaction_time",value:"avg-reaction-time"}]}],analyticsOptions:()=>h.analyticsOptions.get(),daterange:()=>h.daterange.get(),selected:e=>(e===h.analyticsOptions.get().value||e===h.chartOptions.get().value)&&"selected",showLeftNavButton:()=>"custom"!==h.daterange.get().value,showRightNavButton:()=>"custom"!==h.daterange.get().value&&"today"!==h.daterange.get().value&&"this-week"!==h.daterange.get().value&&"this-month"!==h.daterange.get().value,departmentModifier:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const a=e.get();return"".concat(0===a.length?t:t.replace(new RegExp(e.get(),"i"),e=>"<strong>".concat(e,"</strong>")))}),onClickTagDepartment:()=>o.instance().onClickTagDepartment,selectedDepartments:()=>o.instance().selectedDepartments.get(),onSelectDepartments:()=>o.instance().onSelectDepartments,hasDepartments:()=>o.instance().hasDepartments.get()}),o.livechatAnalytics.onCreated((async function(){h=o.instance(),this.analyticsOverviewData=new i,this.agentOverviewData=new i,this.daterange=new i({}),this.analyticsOptions=new i({name:"Conversations",value:"conversations",chartOptions:[{name:"Total_conversations",value:"total-conversations"},{name:"Avg_chat_duration",value:"avg-chat-duration"},{name:"Total_messages",value:"total-messages"}]}),this.chartOptions=new i({name:"Total_conversations",value:"total-conversations"}),this.selectedDepartments=new i([]),this.hasDepartments=new i(!1),this.onSelectDepartments=e=>{let{item:t}=e;t.text=t.name,this.selectedDepartments.set([t])},this.onClickTagDepartment=()=>{this.selectedDepartments.set([])};const{departments:e}=await p.v1.get("livechat/department?count=1");this.hasDepartments.set((null==e?void 0:e.length)>0),this.autorun(()=>{h.daterange.set(m())})})),o.livechatAnalytics.onRendered(()=>{r.autorun(()=>{h.daterange.get()&&h.analyticsOptions.get()&&h.chartOptions.get()&&(y(),f())})}),o.livechatAnalytics.events({"click .lc-date-picker-btn"(e){e.preventDefault();const t=[],a={template:"livechatAnalyticsDaterange",currentTarget:e.currentTarget,data:{options:t,daterange:h.daterange},offsetVertical:e.currentTarget.clientHeight+10};v.open(a)},"click .lc-daterange-prev"(e){e.preventDefault(),h.daterange.set(u(h.daterange.get(),-1))},"click .lc-daterange-next"(e){e.preventDefault(),h.daterange.set(u(h.daterange.get(),1))},"change #lc-analytics-options"(e){e.preventDefault(),h.analyticsOptions.set([{name:"Conversations",value:"conversations",chartOptions:[{name:"Total_conversations",value:"total-conversations"},{name:"Avg_chat_duration",value:"avg-chat-duration"},{name:"Total_messages",value:"total-messages"}]},{name:"Productivity",value:"productivity",chartOptions:[{name:"Avg_first_response_time",value:"avg-first-response-time"},{name:"Best_first_response_time",value:"best_first_response_time"},{name:"Avg_response_time",value:"avg-response-time"},{name:"Avg_reaction_time",value:"avg-reaction-time"}]}].filter((function(t){return t.value===e.currentTarget.value}))[0]),h.chartOptions.set(h.analyticsOptions.get().chartOptions[0])},"change #lc-analytics-chart-options"(e){e.preventDefault(),h.chartOptions.set(h.analyticsOptions.get().chartOptions.filter((function(t){return t.value===e.currentTarget.value}))[0])}})}

