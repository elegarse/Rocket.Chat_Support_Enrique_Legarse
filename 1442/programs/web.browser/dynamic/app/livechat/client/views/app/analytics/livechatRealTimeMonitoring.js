function module(t,e,a){let c,n,s,r,i,o,l,h,d;a.link("@babel/runtime/helpers/objectSpread2",{default(t){c=t}},0),a.link("@babel/runtime/helpers/objectWithoutProperties",{default(t){n=t}},1),a.link("meteor/templating",{Template(t){s=t}},0),a.link("moment",{default(t){r=t}},1),a.link("meteor/reactive-var",{ReactiveVar(t){i=t}},2),a.link("../../../lib/chartHandler",{drawLineChart(t){o=t},drawDoughnutChart(t){l=t},updateChart(t){h=t}},3),a.link("../../../../../utils/client",{APIClient(t){d=t}},4),a.link("./livechatRealTimeMonitoring.html");const g={};let m;const v={"lc-chats-chart":()=>l(document.getElementById("lc-chats-chart"),"Chats",g["lc-chats-chart"],["Open","Queue","Closed"],[0,0,0]),"lc-agents-chart":()=>l(document.getElementById("lc-agents-chart"),"Agents",g["lc-agents-chart"],["Available","Away","Busy","Offline"],[0,0,0,0]),"lc-chats-per-agent-chart":()=>o(document.getElementById("lc-chats-per-agent-chart"),g["lc-chats-per-agent-chart"],["Open","Closed"],[],[[],[]],{legends:!0,anim:!0,smallTicks:!0}),"lc-chats-per-dept-chart":()=>document.getElementById("lc-chats-per-dept-chart")?o(document.getElementById("lc-chats-per-dept-chart"),g["lc-chats-per-dept-chart"],["Open","Closed"],[],[[],[]],{legends:!0,anim:!0,smallTicks:!0}):null,"lc-reaction-response-times-chart"(){const t=[],e=[],a=r().startOf("day");for(let c=a;c.diff(r(),"hours")<0;c.add(1,"hours")){const a=c.format("H");t.push("".concat(r(a,["H"]).format("hA"),"-").concat(r((parseInt(a)+1)%24,["H"]).format("hA"))),e.push(0)}return o(document.getElementById("lc-reaction-response-times-chart"),g["lc-reaction-response-times-chart"],["Avg_reaction_time","Longest_reaction_time","Avg_response_time","Longest_response_time"],t.slice(),[e.slice(),e.slice(),e.slice(),e.slice()],{legends:!0,anim:!0,smallTicks:!0})},"lc-chat-duration-chart"(){const t=[],e=[],a=r().startOf("day");for(let c=a;c.diff(r(),"hours")<0;c.add(1,"hours")){const a=c.format("H");t.push("".concat(r(a,["H"]).format("hA"),"-").concat(r((parseInt(a)+1)%24,["H"]).format("hA"))),e.push(0)}return o(document.getElementById("lc-chat-duration-chart"),g["lc-chat-duration-chart"],["Avg_chat_duration","Longest_chat_duration"],t.slice(),[e.slice(),e.slice()],{legends:!0,anim:!0,smallTicks:!0})}},p=async()=>{g["lc-chats-chart"]=await v["lc-chats-chart"](),g["lc-agents-chart"]=await v["lc-agents-chart"](),g["lc-chats-per-agent-chart"]=await v["lc-chats-per-agent-chart"](),g["lc-chats-per-dept-chart"]=await v["lc-chats-per-dept-chart"](),g["lc-reaction-response-times-chart"]=await v["lc-reaction-response-times-chart"](),g["lc-chat-duration-chart"]=await v["lc-chat-duration-chart"]()},u=async(t,e,a)=>{g[t]||(g[t]=await v[t]()),await h(g[t],e,a)};let w;const y=t=>null==t?void 0:t._id,f=()=>{const t=r(new Date);return{start:"".concat(r(new Date(t.year(),t.month(),t.date(),0,0,0)).utc().format("YYYY-MM-DDTHH:mm:ss"),"Z"),end:"".concat(r(new Date(t.year(),t.month(),t.date(),23,59,59)).utc().format("YYYY-MM-DDTHH:mm:ss"),"Z")}},D=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"".concat(e).concat(Object.keys(t).map(e=>"".concat(e,"=").concat(t[e])).join("&"))},O=async t=>{let{start:e,end:a}=t,c=n(t,["start","end"]);const s=D(c,"&"),{totalizers:r}=await d.v1.get("livechat/analytics/dashboards/conversation-totalizers?start=".concat(e,"&end=").concat(a).concat(s));return r},b=async t=>{t&&Array.isArray(t)&&m.conversationsOverview.set(t)},A=async t=>{let{start:e,end:a}=t,c=n(t,["start","end"]);const s=D(c,"&"),{totalizers:r}=await d.v1.get("livechat/analytics/dashboards/agents-productivity-totalizers?start=".concat(e,"&end=").concat(a).concat(s));return r},k=async t=>{t&&Array.isArray(t)&&m.agentsOverview.set(t)},I=async t=>{let{start:e,end:a}=t,c=n(t,["start","end"]);const s=D(c,"&"),{totalizers:r}=await d.v1.get("livechat/analytics/dashboards/chats-totalizers?start=".concat(e,"&end=").concat(a).concat(s));return r},T=async t=>{t&&Array.isArray(t)&&m.chatsOverview.set(t)},H=async t=>{let{start:e,end:a}=t,c=n(t,["start","end"]);const s=D(c,"&"),{totalizers:r}=await d.v1.get("livechat/analytics/dashboards/productivity-totalizers?start=".concat(e,"&end=").concat(a).concat(s));return r},C=async t=>{t&&Array.isArray(t)&&m.timingOverview.set(t)},_=t=>{let{start:e,end:a}=t,c=n(t,["start","end"]);const s=D(c,"&");return d.v1.get("livechat/analytics/dashboards/charts/chats?start=".concat(e,"&end=").concat(a).concat(s))},M=async t=>{let{open:e,closed:a,queued:c}=t;await u("lc-chats-chart","Open",[e]),await u("lc-chats-chart","Closed",[a]),await u("lc-chats-chart","Queue",[c])},E=async t=>{let{start:e,end:a}=t,c=n(t,["start","end"]);const s=D(c,"&"),r=await d.v1.get("livechat/analytics/dashboards/charts/chats-per-agent?start=".concat(e,"&end=").concat(a).concat(s));return delete r.success,r},z=async t=>{g["lc-chats-per-agent-chart"]=await v["lc-chats-per-agent-chart"](),Object.keys(t).forEach(e=>u("lc-chats-per-agent-chart",e,[t[e].open,t[e].closed]))},B=t=>{let{departmentId:e}=t;const a=D({departmentId:e},"?");return d.v1.get("livechat/analytics/dashboards/charts/agents-status".concat(a))},L=async t=>{t&&(await u("lc-agents-chart","Offline",[t.offline]),await u("lc-agents-chart","Available",[t.available]),await u("lc-agents-chart","Away",[t.away]),await u("lc-agents-chart","Busy",[t.busy]))},R=async t=>{let{start:e,end:a}=t,c=n(t,["start","end"]);const s=D(c,"&"),r=await d.v1.get("livechat/analytics/dashboards/charts/chats-per-department?start=".concat(e,"&end=").concat(a).concat(s));return delete r.success,r},j=async t=>{g["lc-chats-per-dept-chart"]=await v["lc-chats-per-dept-chart"](),Object.keys(t).forEach(e=>u("lc-chats-per-dept-chart",e,[t[e].open,t[e].closed]))},Y=t=>{let{start:e,end:a}=t,c=n(t,["start","end"]);const s=D(c,"&");return d.v1.get("livechat/analytics/dashboards/charts/timings?start=".concat(e,"&end=").concat(a).concat(s))},S=async t=>{const e=r(new Date).format("H"),a="".concat(r(e,["H"]).format("hA"),"-").concat(r((parseInt(e)+1)%24,["H"]).format("hA"));await u("lc-reaction-response-times-chart",a,[t.reaction.avg,t.reaction.longest,t.response.avg,t.response.longest]),await u("lc-chat-duration-chart",a,[t.chatDuration.avg,t.chatDuration.longest])},x=()=>1e3*m.interval.get();s.livechatRealTimeMonitoring.helpers({selected:t=>(t===m.analyticsOptions.get().value||t===m.chartOptions.get().value)&&"selected",conversationsOverview:()=>m.conversationsOverview.get(),timingOverview:()=>m.timingOverview.get(),agentsOverview:()=>m.agentsOverview.get(),chatsOverview:()=>m.chatsOverview.get(),isLoading:()=>s.instance().isLoading.get(),departmentModifier:()=>(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const a=t.get();return"".concat(0===a.length?e:e.replace(new RegExp(t.get(),"i"),t=>"<strong>".concat(t,"</strong>")))}),onClickTagDepartment:()=>s.instance().onClickTagDepartment,selectedDepartments:()=>s.instance().selectedDepartments.get(),onSelectDepartments:()=>s.instance().onSelectDepartments,hasDepartments:()=>s.instance().hasDepartments.get()}),s.livechatRealTimeMonitoring.onCreated((async function(){m=s.instance(),this.isLoading=new i(!1),this.conversationsOverview=new i,this.timingOverview=new i,this.chatsOverview=new i,this.agentsOverview=new i,this.conversationTotalizers=new i([]),this.interval=new i(5),this.selectedDepartments=new i([]),this.hasDepartments=new i(!1),this.onSelectDepartments=t=>{let{item:e}=t;e.text=e.name,this.selectedDepartments.set([e])},this.onClickTagDepartment=()=>{this.selectedDepartments.set([])};const{departments:t}=await d.v1.get("livechat/department?count=1");this.hasDepartments.set((null==t?void 0:t.length)>0)})),s.livechatRealTimeMonitoring.onRendered((async function(){await p(),this.updateDashboard=async()=>{const[t]=this.selectedDepartments.get(),e=y(t),a=f(),n=Object.assign(c({},a),e&&{departmentId:e});b(await O(n)),C(await H(n)),M(await _(n)),z(await E(n)),L(await B(n)),j(await R(n)),S(await Y(n)),k(await A(n)),T(await I(n))},this.autorun(()=>{w&&clearInterval(w),w=setInterval(()=>this.updateDashboard(),x())}),this.isLoading.set(!0),await this.updateDashboard(),this.isLoading.set(!1)})),s.livechatRealTimeMonitoring.events({"change .js-interval":(t,e)=>{e.interval.set(t.target.value)}}),s.livechatRealTimeMonitoring.onDestroyed((function(){clearInterval(w)}))}

