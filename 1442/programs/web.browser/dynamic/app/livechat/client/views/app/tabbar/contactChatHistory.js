function module(t,e,s){let i,a,o,n,r,c,h,l;s.link("@babel/runtime/helpers/objectSpread2",{default(t){i=t}},0),s.link("meteor/tracker",{Tracker(t){a=t}},0),s.link("meteor/templating",{Template(t){o=t}},1),s.link("moment",{default(t){n=t}},2),s.link("meteor/reactive-var",{ReactiveVar(t){r=t}},3),s.link("./contactChatHistory.html"),s.link("./contactChatHistoryItem.html"),s.link("underscore",{default(t){c=t}},4),s.link("../../../../../utils/client",{t(t){h=t},APIClient(t){l=t}},5);const g=50;o.contactChatHistory.helpers({isReady:()=>o.instance().isReady.get(),hasChatHistory:()=>o.instance().history.get().length>0,history:()=>o.instance().history.get(),isLoading:()=>o.instance().isLoading.get(),isSearching:()=>o.instance().searchTerm.get().length>0,showChatHistoryMessages:()=>o.instance().showChatHistoryMessages.get(),chatHistoryMessagesContext:()=>i({tabBar:o.instance().tabBar,clear:o.instance().returnChatHistoryList},o.instance().chatHistoryMessagesContext.get()),canSearch:()=>o.instance().canSearch.get()}),o.contactChatHistory.onCreated((async function(){const t=o.currentData();this.offset=new r(0),this.visitorId=new r,this.history=new r([]),this.searchTerm=new r(""),this.hasMore=new r(!0),this.isLoading=new r(!0),this.chatHistoryMessagesContext=new r,this.showChatHistoryMessages=new r(!1),this.limit=new r(50),this.isReady=new r(!1),this.canSearch=new r(!1),this.tabBar=t.tabBar,this.returnChatHistoryList=()=>{this.showChatHistoryMessages.set(!1),this.chatHistoryMessagesContext.set(),this.tabBar.setData({label:"Contact_Chat_History",icon:"clock"})},this.autorun(async()=>{if(!this.visitorId.get()||!t||!t.rid)return;const e=this.limit.get(),s=this.offset.get(),i=this.searchTerm.get();let a="livechat/visitors.searchChats/room/".concat(t.rid,"/visitor/").concat(this.visitorId.get(),"?count=").concat(e,"&offset=").concat(s,"&closedChatsOnly=true&servedChatsOnly=true");i&&(a+="&searchText=".concat(i)),this.isLoading.set(!0);const{history:o,total:n}=await l.v1.get(a);this.history.set(0===s?o:this.history.get().concat(o)),this.hasMore.set(n>this.history.get().length),this.isLoading.set(!1)}),this.autorun(async()=>{const{room:e}=await l.v1.get("rooms.info?roomId=".concat(t.rid));(null==e?void 0:e.v)&&this.visitorId.set(e.v._id)})})),o.contactChatHistory.onRendered((function(){a.autorun(t=>{if(this.isLoading.get())return;const e=this.history.get();this.canSearch.set(e&&e.length>0),this.isReady.set(!0),t.stop()})})),o.contactChatHistory.events({"scroll .js-list":c.throttle((function(t,e){t.target.scrollTop>=t.target.scrollHeight-t.target.clientHeight-10&&e.hasMore.get()&&e.offset.set(e.offset.get()+e.limit.get())}),200),"click .chat-history-item"(t,e){t.preventDefault(),t.stopPropagation();const{_id:s,v:{name:i,username:a}={},closedAt:o}=this,r=h("Closed_At"),c=n(o).format("MMM D YYYY");e.chatHistoryMessagesContext.set({label:"".concat(i||a,", ").concat(r," ").concat(c),rid:s}),e.showChatHistoryMessages.set(!0)},"keyup #chat-search":c.debounce((function(t,e){if(13===t.keyCode)return t.preventDefault();const{value:s}=t.target;if(40===t.keyCode||38===t.keyCode)return t.preventDefault();e.offset.set(0),e.searchTerm.set(s)}),300)})}

