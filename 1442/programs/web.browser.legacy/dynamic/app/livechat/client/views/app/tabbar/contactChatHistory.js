function module(t,e,n){var s,r,i,a,o,c,u,h,l;n.link("@babel/runtime/regenerator",{default:function(t){s=t}},0),n.link("@babel/runtime/helpers/objectSpread2",{default:function(t){r=t}},1),n.link("meteor/tracker",{Tracker:function(t){i=t}},0),n.link("meteor/templating",{Template:function(t){a=t}},1),n.link("moment",{default:function(t){o=t}},2),n.link("meteor/reactive-var",{ReactiveVar:function(t){c=t}},3),n.link("./contactChatHistory.html"),n.link("./contactChatHistoryItem.html"),n.link("underscore",{default:function(t){u=t}},4),n.link("../../../../../utils/client",{t:function(t){h=t},APIClient:function(t){l=t}},5);var f=50;a.contactChatHistory.helpers({isReady:function(){return a.instance().isReady.get()},hasChatHistory:function(){return a.instance().history.get().length>0},history:function(){return a.instance().history.get()},isLoading:function(){return a.instance().isLoading.get()},isSearching:function(){return a.instance().searchTerm.get().length>0},showChatHistoryMessages:function(){return a.instance().showChatHistoryMessages.get()},chatHistoryMessagesContext:function(){return r({tabBar:a.instance().tabBar,clear:a.instance().returnChatHistoryList},a.instance().chatHistoryMessagesContext.get())},canSearch:function(){return a.instance().canSearch.get()}}),a.contactChatHistory.onCreated(function(){function t(){var t=this,e;return s.async(function(){function n(n){for(;;)switch(n.prev=n.next){case 0:e=a.currentData(),this.offset=new c(0),this.visitorId=new c,this.history=new c([]),this.searchTerm=new c(""),this.hasMore=new c(!0),this.isLoading=new c(!0),this.chatHistoryMessagesContext=new c,this.showChatHistoryMessages=new c(!1),this.limit=new c(f),this.isReady=new c(!1),this.canSearch=new c(!1),this.tabBar=e.tabBar,this.returnChatHistoryList=function(){t.showChatHistoryMessages.set(!1),t.chatHistoryMessagesContext.set(),t.tabBar.setData({label:"Contact_Chat_History",icon:"clock"})},this.autorun(function(){function n(){var n,r,i,a,o,c,u;return s.async(function(){function h(h){for(;;)switch(h.prev=h.next){case 0:if(t.visitorId.get()&&e&&e.rid){h.next=2;break}return h.abrupt("return");case 2:return n=t.limit.get(),r=t.offset.get(),i=t.searchTerm.get(),a="livechat/visitors.searchChats/room/"+e.rid+"/visitor/"+t.visitorId.get()+"?count="+n+"&offset="+r+"&closedChatsOnly=true&servedChatsOnly=true",i&&(a+="&searchText="+i),t.isLoading.set(!0),h.next=10,s.awrap(l.v1.get(a));case 10:o=h.sent,c=o.history,u=o.total,t.history.set(0===r?c:t.history.get().concat(c)),t.hasMore.set(u>t.history.get().length),t.isLoading.set(!1);case 16:case"end":return h.stop()}}return h}(),null,null,null,Promise)}return n}()),this.autorun(function(){function n(){var n,r;return s.async(function(){function i(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,s.awrap(l.v1.get("rooms.info?roomId="+e.rid));case 2:n=i.sent,(null==(r=n.room)?void 0:r.v)&&t.visitorId.set(r.v._id);case 5:case"end":return i.stop()}}return i}(),null,null,null,Promise)}return n}());case 16:case"end":return n.stop()}}return n}(),null,this,null,Promise)}return t}()),a.contactChatHistory.onRendered((function(){var t=this;i.autorun((function(e){if(!t.isLoading.get()){var n=t.history.get();t.canSearch.set(n&&n.length>0),t.isReady.set(!0),e.stop()}}))})),a.contactChatHistory.events({"scroll .js-list":u.throttle((function(t,e){t.target.scrollTop>=t.target.scrollHeight-t.target.clientHeight-10&&e.hasMore.get()&&e.offset.set(e.offset.get()+e.limit.get())}),200),"click .chat-history-item":function(t,e){t.preventDefault(),t.stopPropagation();var n=this._id,s=this.v,r=(s=void 0===s?{}:s).name,i=s.username,a=this.closedAt,c=h("Closed_At"),u=o(a).format("MMM D YYYY");e.chatHistoryMessagesContext.set({label:(r||i)+", "+c+" "+u,rid:n}),e.showChatHistoryMessages.set(!0)},"keyup #chat-search":u.debounce((function(t,e){if(13===t.keyCode)return t.preventDefault();var n=t.target.value;if(40===t.keyCode||38===t.keyCode)return t.preventDefault();e.offset.set(0),e.searchTerm.set(n)}),300)})}

