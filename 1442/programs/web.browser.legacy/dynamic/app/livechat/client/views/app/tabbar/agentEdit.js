function module(t,e,n){var a,r,i,s,c,u,l,o,m,p,d;n.link("@babel/runtime/regenerator",{default:function(t){a=t}},0),n.link("@babel/runtime/helpers/toConsumableArray",{default:function(t){r=t}},1),n.link("meteor/meteor",{Meteor:function(t){i=t}},0),n.link("meteor/reactive-var",{ReactiveVar:function(t){s=t}},1),n.link("meteor/templating",{Template:function(t){c=t}},2),n.link("toastr",{default:function(t){u=t}},3),n.link("../customTemplates/register",{getCustomFormTemplate:function(t){l=t}},4),n.link("./agentEdit.html"),n.link("../../../../../authorization",{hasPermission:function(t){o=t}},5),n.link("../../../../../utils/client",{t:function(t){m=t},handleError:function(t){p=t},APIClient:function(t){d=t}},6),c.agentEdit.helpers({canEditDepartment:function(){return o("add-livechat-department-agents")},agent:function(){return c.instance().agent.get()},availableDepartments:function(){return c.instance().availableDepartments.get()},hasAvailableDepartments:function(){var t;if(o("add-livechat-department-agents"))return r(c.instance().availableDepartments.get()).length>0},agentDepartments:function(){var t=c.instance().agentDepartments.get(),e;return c.instance().departments.get().filter((function(e){var n=e._id;return t.includes(n)}))},hasAgentDepartments:function(){var t;return r(c.instance().agentDepartments.get()).length>0},customFieldsTemplate:function(){return l("livechatAgentEditForm")},agentDataContext:function(){return c.instance().agent},isReady:function(){var t=c.instance();return t.ready&&t.ready.get()}}),c.agentEdit.events({"click .cancel":function(t){return t.stopPropagation(),t.preventDefault(),this.back&&this.back()},"submit #agent-form":function(t,e){var n=this;t.preventDefault();var a=$(t.currentTarget).data("id"),r={};e.$(".customFormField").each((function(t,n){var a=e.$(n),i=a.attr("name");r[i]=a.val()}));var s=e.agentDepartments.get();i.call("livechat:saveAgentInfo",a,r,s,(function(t){return t?p(t):(u.success(m("Saved")),n.back&&n.back(a))}))},"click .remove-department":function(t,e){if(t.stopPropagation(),t.preventDefault(),o("add-livechat-department-agents")){var n=t.currentTarget.dataset.id,a=e.agentDepartments.get();e.agentDepartments.set(a.filter((function(t){return t!==n})))}},"click #addDepartment":function(t,e){if(t.stopPropagation(),t.preventDefault(),!$("#departmentSelect").find(":selected").is(":disabled")){var n=r(e.agentDepartments.get()),a=$("#departmentSelect").val();""===a||n.indexOf(a)>-1||(n.push(a),e.agentDepartments.set(n),$("#departmentSelect").val("placeholder"))}}}),c.agentEdit.onCreated(function(){function t(){var t=this,e,n;return a.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:return this.agent=new s,this.ready=new s(!1),this.agentDepartments=new s([]),this.departments=new s([]),this.availableDepartments=new s([]),this.back=c.currentData().back,r.next=8,a.awrap(d.v1.get('livechat/department?sort={"name": 1}'));case 8:e=r.sent,n=e.departments,this.departments.set(n),this.availableDepartments.set(n.filter((function(t){var e;return t.enabled}))),this.autorun(function(){function e(){var e,n,r,i,s,u;return a.async(function(){function l(l){for(;;)switch(l.prev=l.next){case 0:if(t.ready.set(!1),e=c.currentData(),n=e.agentId){l.next=4;break}return l.abrupt("return");case 4:return l.next=6,a.awrap(d.v1.get("livechat/users/agent/"+n));case 6:return r=l.sent,i=r.user,l.next=10,a.awrap(d.v1.get("livechat/agents/"+n+"/departments"));case 10:s=l.sent,u=s.departments,t.agent.set(i),t.agentDepartments.set((u||[]).map((function(t){return t.departmentId}))),t.ready.set(!0);case 15:case"end":return l.stop()}}return l}(),null,null,null,Promise)}return e}());case 13:case"end":return r.stop()}}return r}(),null,this,null,Promise)}return t}())}

