function module(e,t,s){var n,r,a,i,o,c,l;s.link("@babel/runtime/regenerator",{default:function(e){n=e}},0),s.link("@babel/runtime/helpers/objectSpread2",{default:function(e){r=e}},1),s.link("meteor/templating",{Template:function(e){a=e}},0),s.link("./contactChatHistoryMessages.html"),s.link("meteor/reactive-var",{ReactiveVar:function(e){i=e}},1),s.link("underscore",{default:function(e){o=e}},2),s.link("../../../../../ui-utils/client/lib/messageContext",{messageContext:function(e){c=e}},3),s.link("../../../../../utils/client",{APIClient:function(e){l=e}},4);var u=50;a.contactChatHistoryMessages.helpers({messages:function(){return a.instance().messages.get()},messageContext:function(){var e=c.call(this,{rid:a.instance().rid});return r({},e,{settings:r({},e.settings,{showReplyButton:!1,showreply:!1,hideRoles:!0})})},hasMore:function(){return a.instance().hasMore.get()},isLoading:function(){return a.instance().isLoading.get()},isSearching:function(){return a.instance().searchTerm.get().length>0},empty:function(){return 0===a.instance().messages.get().length}}),a.contactChatHistoryMessages.events({"click .js-back":function(e,t){return t.clear()},"scroll .js-list":o.throttle((function(e,t){e.target.scrollTop>=e.target.scrollHeight-e.target.clientHeight&&t.hasMore.get()&&t.offset.set(t.offset.get()+t.limit.get())}),200),"keyup #message-search":o.debounce((function(e,t){if(13===e.keyCode)return e.preventDefault();var s=e.target.value;if(40===e.keyCode||38===e.keyCode)return e.preventDefault();t.offset.set(0),t.searchTerm.set(s)}),300)}),a.contactChatHistoryMessages.onCreated((function(){var e=this,t=a.currentData();this.rid=t.rid,this.messages=new i([]),this.hasMore=new i(!0),this.offset=new i(0),this.searchTerm=new i(""),this.isLoading=new i(!0),this.limit=new i(50),this.loadMessages=function(){function t(t){var s,r,a,i;return n.async(function(){function o(o){for(;;)switch(o.prev=o.next){case 0:return e.isLoading.set(!0),s=e.offset.get(),o.next=4,n.awrap(l.v1.get(t));case 4:r=o.sent,a=r.messages,i=r.total,e.messages.set(0===s?a:e.messages.get().concat(a)),e.hasMore.set(i>e.messages.get().length),e.isLoading.set(!1);case 10:case"end":return o.stop()}}return o}(),null,null,null,Promise)}return t}(),this.autorun((function(){var t=e.limit.get(),s=e.offset.get(),n=e.searchTerm.get();if(""!==n)return e.loadMessages("chat.search/?roomId="+e.rid+"&searchText="+n+"&count="+t+"&offset="+s+'&sort={"ts": 1}');e.loadMessages("channels.messages/?roomId="+e.rid+"&count="+t+"&offset="+s+'&sort={"ts": 1}&query={"$or": [ {"t": {"$exists": false} }, {"t": "livechat-close"} ] }')})),this.autorun((function(){null!=t.clear&&(e.clear=t.clear)}))}))}

