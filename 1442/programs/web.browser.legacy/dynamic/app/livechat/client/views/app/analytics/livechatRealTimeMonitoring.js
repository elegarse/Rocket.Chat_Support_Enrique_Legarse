function module(t,e,n){var r,a,c,s,u,i,o,l,h,f,p;n.link("@babel/runtime/helpers/objectSpread2",{default:function(t){r=t}},0),n.link("@babel/runtime/helpers/slicedToArray",{default:function(t){a=t}},1),n.link("@babel/runtime/helpers/objectWithoutProperties",{default:function(t){c=t}},2),n.link("@babel/runtime/regenerator",{default:function(t){s=t}},3),n.link("meteor/templating",{Template:function(t){u=t}},0),n.link("moment",{default:function(t){i=t}},1),n.link("meteor/reactive-var",{ReactiveVar:function(t){o=t}},2),n.link("../../../lib/chartHandler",{drawLineChart:function(t){l=t},drawDoughnutChart:function(t){h=t},updateChart:function(t){f=t}},3),n.link("../../../../../utils/client",{APIClient:function(t){p=t}},4),n.link("./livechatRealTimeMonitoring.html");var d={},v,m={"lc-chats-chart":function(){return h(document.getElementById("lc-chats-chart"),"Chats",d["lc-chats-chart"],["Open","Queue","Closed"],[0,0,0])},"lc-agents-chart":function(){return h(document.getElementById("lc-agents-chart"),"Agents",d["lc-agents-chart"],["Available","Away","Busy","Offline"],[0,0,0,0])},"lc-chats-per-agent-chart":function(){return l(document.getElementById("lc-chats-per-agent-chart"),d["lc-chats-per-agent-chart"],["Open","Closed"],[],[[],[]],{legends:!0,anim:!0,smallTicks:!0})},"lc-chats-per-dept-chart":function(){return document.getElementById("lc-chats-per-dept-chart")?l(document.getElementById("lc-chats-per-dept-chart"),d["lc-chats-per-dept-chart"],["Open","Closed"],[],[[],[]],{legends:!0,anim:!0,smallTicks:!0}):null},"lc-reaction-response-times-chart":function(){for(var t=[],e=[],n,r=i().startOf("day");r.diff(i(),"hours")<0;r.add(1,"hours")){var a=r.format("H");t.push(i(a,["H"]).format("hA")+"-"+i((parseInt(a)+1)%24,["H"]).format("hA")),e.push(0)}return l(document.getElementById("lc-reaction-response-times-chart"),d["lc-reaction-response-times-chart"],["Avg_reaction_time","Longest_reaction_time","Avg_response_time","Longest_response_time"],t.slice(),[e.slice(),e.slice(),e.slice(),e.slice()],{legends:!0,anim:!0,smallTicks:!0})},"lc-chat-duration-chart":function(){for(var t=[],e=[],n,r=i().startOf("day");r.diff(i(),"hours")<0;r.add(1,"hours")){var a=r.format("H");t.push(i(a,["H"]).format("hA")+"-"+i((parseInt(a)+1)%24,["H"]).format("hA")),e.push(0)}return l(document.getElementById("lc-chat-duration-chart"),d["lc-chat-duration-chart"],["Avg_chat_duration","Longest_chat_duration"],t.slice(),[e.slice(),e.slice()],{legends:!0,anim:!0,smallTicks:!0})}},g=function(){function t(){return s.async(function(){function t(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.awrap(m["lc-chats-chart"]());case 2:return d["lc-chats-chart"]=t.sent,t.next=5,s.awrap(m["lc-agents-chart"]());case 5:return d["lc-agents-chart"]=t.sent,t.next=8,s.awrap(m["lc-chats-per-agent-chart"]());case 8:return d["lc-chats-per-agent-chart"]=t.sent,t.next=11,s.awrap(m["lc-chats-per-dept-chart"]());case 11:return d["lc-chats-per-dept-chart"]=t.sent,t.next=14,s.awrap(m["lc-reaction-response-times-chart"]());case 14:return d["lc-reaction-response-times-chart"]=t.sent,t.next=17,s.awrap(m["lc-chat-duration-chart"]());case 17:d["lc-chat-duration-chart"]=t.sent;case 18:case"end":return t.stop()}}return t}(),null,null,null,Promise)}return t}(),w=function(){function t(t,e,n){return s.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:if(d[t]){r.next=4;break}return r.next=3,s.awrap(m[t]());case 3:d[t]=r.sent;case 4:return r.next=6,s.awrap(f(d[t],e,n));case 6:case"end":return r.stop()}}return r}(),null,null,null,Promise)}return t}(),y,x=function(t){return null==t?void 0:t._id},b=function(){var t=i(new Date);return{start:i(new Date(t.year(),t.month(),t.date(),0,0,0)).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",end:i(new Date(t.year(),t.month(),t.date(),23,59,59)).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z"}},D=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return""+e+Object.keys(t).map((function(e){return e+"="+t[e]})).join("&")},O=function(){function t(t){var e,n,r,a,u,i;return s.async(function(){function o(o){for(;;)switch(o.prev=o.next){case 0:return e=t.start,n=t.end,r=c(t,["start","end"]),a=D(r,"&"),o.next=4,s.awrap(p.v1.get("livechat/analytics/dashboards/conversation-totalizers?start="+e+"&end="+n+a));case 4:return u=o.sent,i=u.totalizers,o.abrupt("return",i);case 7:case"end":return o.stop()}}return o}(),null,null,null,Promise)}return t}(),A=function(){function t(t){return s.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:t&&Array.isArray(t)&&v.conversationsOverview.set(t);case 1:case"end":return e.stop()}}return e}(),null,null,null,Promise)}return t}(),k=function(){function t(t){var e,n,r,a,u,i;return s.async(function(){function o(o){for(;;)switch(o.prev=o.next){case 0:return e=t.start,n=t.end,r=c(t,["start","end"]),a=D(r,"&"),o.next=4,s.awrap(p.v1.get("livechat/analytics/dashboards/agents-productivity-totalizers?start="+e+"&end="+n+a));case 4:return u=o.sent,i=u.totalizers,o.abrupt("return",i);case 7:case"end":return o.stop()}}return o}(),null,null,null,Promise)}return t}(),P=function(){function t(t){return s.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:t&&Array.isArray(t)&&v.agentsOverview.set(t);case 1:case"end":return e.stop()}}return e}(),null,null,null,Promise)}return t}(),T=function(){function t(t){var e,n,r,a,u,i;return s.async(function(){function o(o){for(;;)switch(o.prev=o.next){case 0:return e=t.start,n=t.end,r=c(t,["start","end"]),a=D(r,"&"),o.next=4,s.awrap(p.v1.get("livechat/analytics/dashboards/chats-totalizers?start="+e+"&end="+n+a));case 4:return u=o.sent,i=u.totalizers,o.abrupt("return",i);case 7:case"end":return o.stop()}}return o}(),null,null,null,Promise)}return t}(),I=function(){function t(t){return s.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:t&&Array.isArray(t)&&v.chatsOverview.set(t);case 1:case"end":return e.stop()}}return e}(),null,null,null,Promise)}return t}(),H=function(){function t(t){var e,n,r,a,u,i;return s.async(function(){function o(o){for(;;)switch(o.prev=o.next){case 0:return e=t.start,n=t.end,r=c(t,["start","end"]),a=D(r,"&"),o.next=4,s.awrap(p.v1.get("livechat/analytics/dashboards/productivity-totalizers?start="+e+"&end="+n+a));case 4:return u=o.sent,i=u.totalizers,o.abrupt("return",i);case 7:case"end":return o.stop()}}return o}(),null,null,null,Promise)}return t}(),C=function(){function t(t){return s.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:t&&Array.isArray(t)&&v.timingOverview.set(t);case 1:case"end":return e.stop()}}return e}(),null,null,null,Promise)}return t}(),_=function(t){var e=t.start,n=t.end,r=c(t,["start","end"]),a=D(r,"&");return p.v1.get("livechat/analytics/dashboards/charts/chats?start="+e+"&end="+n+a)},M=function(){function t(t){var e,n,r;return s.async(function(){function a(a){for(;;)switch(a.prev=a.next){case 0:return e=t.open,n=t.closed,r=t.queued,a.next=3,s.awrap(w("lc-chats-chart","Open",[e]));case 3:return a.next=5,s.awrap(w("lc-chats-chart","Closed",[n]));case 5:return a.next=7,s.awrap(w("lc-chats-chart","Queue",[r]));case 7:case"end":return a.stop()}}return a}(),null,null,null,Promise)}return t}(),E=function(){function t(t){var e,n,r,a,u;return s.async(function(){function i(i){for(;;)switch(i.prev=i.next){case 0:return e=t.start,n=t.end,r=c(t,["start","end"]),a=D(r,"&"),i.next=4,s.awrap(p.v1.get("livechat/analytics/dashboards/charts/chats-per-agent?start="+e+"&end="+n+a));case 4:return delete(u=i.sent).success,i.abrupt("return",u);case 7:case"end":return i.stop()}}return i}(),null,null,null,Promise)}return t}(),z=function(){function t(t){return s.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.awrap(m["lc-chats-per-agent-chart"]());case 2:d["lc-chats-per-agent-chart"]=e.sent,Object.keys(t).forEach((function(e){return w("lc-chats-per-agent-chart",e,[t[e].open,t[e].closed])}));case 4:case"end":return e.stop()}}return e}(),null,null,null,Promise)}return t}(),B=function(t){var e=t.departmentId,n=D({departmentId:e},"?");return p.v1.get("livechat/analytics/dashboards/charts/agents-status"+n)},L=function(){function t(t){return s.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,s.awrap(w("lc-agents-chart","Offline",[t.offline]));case 4:return e.next=6,s.awrap(w("lc-agents-chart","Available",[t.available]));case 6:return e.next=8,s.awrap(w("lc-agents-chart","Away",[t.away]));case 8:return e.next=10,s.awrap(w("lc-agents-chart","Busy",[t.busy]));case 10:case"end":return e.stop()}}return e}(),null,null,null,Promise)}return t}(),R=function(){function t(t){var e,n,r,a,u;return s.async(function(){function i(i){for(;;)switch(i.prev=i.next){case 0:return e=t.start,n=t.end,r=c(t,["start","end"]),a=D(r,"&"),i.next=4,s.awrap(p.v1.get("livechat/analytics/dashboards/charts/chats-per-department?start="+e+"&end="+n+a));case 4:return delete(u=i.sent).success,i.abrupt("return",u);case 7:case"end":return i.stop()}}return i}(),null,null,null,Promise)}return t}(),j=function(){function t(t){return s.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.awrap(m["lc-chats-per-dept-chart"]());case 2:d["lc-chats-per-dept-chart"]=e.sent,Object.keys(t).forEach((function(e){return w("lc-chats-per-dept-chart",e,[t[e].open,t[e].closed])}));case 4:case"end":return e.stop()}}return e}(),null,null,null,Promise)}return t}(),Y=function(t){var e=t.start,n=t.end,r=c(t,["start","end"]),a=D(r,"&");return p.v1.get("livechat/analytics/dashboards/charts/timings?start="+e+"&end="+n+a)},S=function(){function t(t){var e,n;return s.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:return e=i(new Date).format("H"),n=i(e,["H"]).format("hA")+"-"+i((parseInt(e)+1)%24,["H"]).format("hA"),r.next=4,s.awrap(w("lc-reaction-response-times-chart",n,[t.reaction.avg,t.reaction.longest,t.response.avg,t.response.longest]));case 4:return r.next=6,s.awrap(w("lc-chat-duration-chart",n,[t.chatDuration.avg,t.chatDuration.longest]));case 6:case"end":return r.stop()}}return r}(),null,null,null,Promise)}return t}(),Q=function(){return 1e3*v.interval.get()};u.livechatRealTimeMonitoring.helpers({selected:function(t){return(t===v.analyticsOptions.get().value||t===v.chartOptions.get().value)&&"selected"},conversationsOverview:function(){return v.conversationsOverview.get()},timingOverview:function(){return v.timingOverview.get()},agentsOverview:function(){return v.agentsOverview.get()},chatsOverview:function(){return v.chatsOverview.get()},isLoading:function(){return u.instance().isLoading.get()},departmentModifier:function(){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=t.get();return""+(0===n.length?e:e.replace(new RegExp(t.get(),"i"),(function(t){return"<strong>"+t+"</strong>"})))}},onClickTagDepartment:function(){return u.instance().onClickTagDepartment},selectedDepartments:function(){return u.instance().selectedDepartments.get()},onSelectDepartments:function(){return u.instance().onSelectDepartments},hasDepartments:function(){return u.instance().hasDepartments.get()}}),u.livechatRealTimeMonitoring.onCreated(function(){function t(){var t=this,e,n;return s.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:return v=u.instance(),this.isLoading=new o(!1),this.conversationsOverview=new o,this.timingOverview=new o,this.chatsOverview=new o,this.agentsOverview=new o,this.conversationTotalizers=new o([]),this.interval=new o(5),this.selectedDepartments=new o([]),this.hasDepartments=new o(!1),this.onSelectDepartments=function(e){var n=e.item;n.text=n.name,t.selectedDepartments.set([n])},this.onClickTagDepartment=function(){t.selectedDepartments.set([])},r.next=14,s.awrap(p.v1.get("livechat/department?count=1"));case 14:e=r.sent,n=e.departments,this.hasDepartments.set((null==n?void 0:n.length)>0);case 17:case"end":return r.stop()}}return r}(),null,this,null,Promise)}return t}()),u.livechatRealTimeMonitoring.onRendered(function(){function t(){var t=this;return s.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.awrap(g());case 2:return this.updateDashboard=function(){function e(){var e,n,c,u,i,o;return s.async(function(){function l(l){for(;;)switch(l.prev=l.next){case 0:return e=t.selectedDepartments.get(),n=a(e,1),c=n[0],u=x(c),i=b(),o=Object.assign(r({},i),u&&{departmentId:u}),l.t0=A,l.next=7,s.awrap(O(o));case 7:return l.t1=l.sent,(0,l.t0)(l.t1),l.t2=C,l.next=12,s.awrap(H(o));case 12:return l.t3=l.sent,(0,l.t2)(l.t3),l.t4=M,l.next=17,s.awrap(_(o));case 17:return l.t5=l.sent,(0,l.t4)(l.t5),l.t6=z,l.next=22,s.awrap(E(o));case 22:return l.t7=l.sent,(0,l.t6)(l.t7),l.t8=L,l.next=27,s.awrap(B(o));case 27:return l.t9=l.sent,(0,l.t8)(l.t9),l.t10=j,l.next=32,s.awrap(R(o));case 32:return l.t11=l.sent,(0,l.t10)(l.t11),l.t12=S,l.next=37,s.awrap(Y(o));case 37:return l.t13=l.sent,(0,l.t12)(l.t13),l.t14=P,l.next=42,s.awrap(k(o));case 42:return l.t15=l.sent,(0,l.t14)(l.t15),l.t16=I,l.next=47,s.awrap(T(o));case 47:l.t17=l.sent,(0,l.t16)(l.t17);case 49:case"end":return l.stop()}}return l}(),null,null,null,Promise)}return e}(),this.autorun((function(){y&&clearInterval(y),y=setInterval((function(){return t.updateDashboard()}),Q())})),this.isLoading.set(!0),e.next=7,s.awrap(this.updateDashboard());case 7:this.isLoading.set(!1);case 8:case"end":return e.stop()}}return e}(),null,this,null,Promise)}return t}()),u.livechatRealTimeMonitoring.events({"change .js-interval":function(t,e){e.interval.set(t.target.value)}}),u.livechatRealTimeMonitoring.onDestroyed((function(){clearInterval(y)}))}

