function module(t,e,n){var a,r,i,c,s,o,l,u,g,v,f,p,d,h,m,D;n.link("@babel/runtime/regenerator",{default:function(t){a=t}},0),n.link("@babel/runtime/helpers/objectSpread2",{default:function(t){r=t}},1),n.link("@babel/runtime/helpers/slicedToArray",{default:function(t){i=t}},2),n.link("meteor/meteor",{Meteor:function(t){c=t}},0),n.link("meteor/reactive-var",{ReactiveVar:function(t){s=t}},1),n.link("meteor/tracker",{Tracker:function(t){o=t}},2),n.link("meteor/templating",{Template:function(t){l=t}},3),n.link("moment",{default:function(t){u=t}},4),n.link("../../../../../utils",{handleError:function(t){g=t}},5),n.link("../../../../../ui-utils",{popover:function(t){v=t}},6),n.link("../../../lib/chartHandler",{drawLineChart:function(t){f=t}},7),n.link("../../../lib/dateHandler",{setDateRange:function(t){p=t},updateDateRange:function(t){d=t}},8),n.link("../../../../../utils/client",{APIClient:function(t){h=t}},9),n.link("./livechatAnalytics.html");var O=function(){return[{name:"Conversations",value:"conversations",chartOptions:[{name:"Total_conversations",value:"total-conversations"},{name:"Avg_chat_duration",value:"avg-chat-duration"},{name:"Total_messages",value:"total-messages"}]},{name:"Productivity",value:"productivity",chartOptions:[{name:"Avg_first_response_time",value:"avg-first-response-time"},{name:"Best_first_response_time",value:"best_first_response_time"},{name:"Avg_response_time",value:"avg-response-time"},{name:"Avg_reaction_time",value:"avg-reaction-time"}]}]},y=function(t,e){for(var n=[];t.length;){var a=Math.ceil(t.length/e--),r=t.slice(0,a);n.push(r),t=t.slice(a)}return n},w=function(t){return null==t?void 0:t._id},k=function(){var t=m.selectedDepartments.get(),e,n=i(t,1)[0],s=w(n),o=r({daterange:{from:u(m.daterange.get().from,"MMM D YYYY").toISOString(),to:u(m.daterange.get().to,"MMM D YYYY").toISOString()},chartOptions:m.chartOptions.get()},s&&{departmentId:s});c.call("livechat:getAnalyticsChartData",o,function(){function t(t,e){return a.async(function(){function n(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=2;break}return n.abrupt("return",g(t));case 2:return e&&e.chartLabel&&e.dataLabels&&e.dataPoints||console.log("livechat:getAnalyticsChartData => Missing Data"),n.next=5,a.awrap(f(document.getElementById("lc-analytics-chart"),D,[e.chartLabel],e.dataLabels,[e.dataPoints]));case 5:D=n.sent;case 6:case"end":return n.stop()}}return n}(),null,null,null,Promise)}return t}()),c.call("livechat:getAgentOverviewData",o,(function(t,e){if(t)return g(t);e||console.log("livechat:getAgentOverviewData => Missing Data"),m.agentOverviewData.set(e)}))},A=function(){var t=m.selectedDepartments.get(),e,n=i(t,1)[0],a=w(n),s=r({daterange:{from:u(m.daterange.get().from,"MMM D YYYY").toISOString(),to:u(m.daterange.get().to,"MMM D YYYY").toISOString()},analyticsOptions:m.analyticsOptions.get()},a&&{departmentId:a});c.call("livechat:getAnalyticsOverviewData",s,(function(t,e){if(t)return g(t);e||console.log("livechat:getAnalyticsOverviewData => Missing Data"),m.analyticsOverviewData.set(y(e,3))}))};l.livechatAnalytics.helpers({analyticsOverviewData:function(){return m.analyticsOverviewData.get()},agentOverviewData:function(){return m.agentOverviewData.get()},analyticsAllOptions:function(){return O()},analyticsOptions:function(){return m.analyticsOptions.get()},daterange:function(){return m.daterange.get()},selected:function(t){return(t===m.analyticsOptions.get().value||t===m.chartOptions.get().value)&&"selected"},showLeftNavButton:function(){return"custom"!==m.daterange.get().value},showRightNavButton:function(){return"custom"!==m.daterange.get().value&&"today"!==m.daterange.get().value&&"this-week"!==m.daterange.get().value&&"this-month"!==m.daterange.get().value},departmentModifier:function(){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=t.get();return""+(0===n.length?e:e.replace(new RegExp(t.get(),"i"),(function(t){return"<strong>"+t+"</strong>"})))}},onClickTagDepartment:function(){return l.instance().onClickTagDepartment},selectedDepartments:function(){return l.instance().selectedDepartments.get()},onSelectDepartments:function(){return l.instance().onSelectDepartments},hasDepartments:function(){return l.instance().hasDepartments.get()}}),l.livechatAnalytics.onCreated(function(){function t(){var t=this,e,n;return a.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:return m=l.instance(),this.analyticsOverviewData=new s,this.agentOverviewData=new s,this.daterange=new s({}),this.analyticsOptions=new s(O()[0]),this.chartOptions=new s(O()[0].chartOptions[0]),this.selectedDepartments=new s([]),this.hasDepartments=new s(!1),this.onSelectDepartments=function(e){var n=e.item;n.text=n.name,t.selectedDepartments.set([n])},this.onClickTagDepartment=function(){t.selectedDepartments.set([])},r.next=12,a.awrap(h.v1.get("livechat/department?count=1"));case 12:e=r.sent,n=e.departments,this.hasDepartments.set((null==n?void 0:n.length)>0),this.autorun((function(){m.daterange.set(p())}));case 16:case"end":return r.stop()}}return r}(),null,this,null,Promise)}return t}()),l.livechatAnalytics.onRendered((function(){o.autorun((function(){m.daterange.get()&&m.analyticsOptions.get()&&m.chartOptions.get()&&(A(),k())}))})),l.livechatAnalytics.events({"click .lc-date-picker-btn":function(t){t.preventDefault();var e=[],n={template:"livechatAnalyticsDaterange",currentTarget:t.currentTarget,data:{options:e,daterange:m.daterange},offsetVertical:t.currentTarget.clientHeight+10};v.open(n)},"click .lc-daterange-prev":function(t){t.preventDefault(),m.daterange.set(d(m.daterange.get(),-1))},"click .lc-daterange-next":function(t){t.preventDefault(),m.daterange.set(d(m.daterange.get(),1))},"change #lc-analytics-options":function(t){t.preventDefault(),m.analyticsOptions.set(O().filter((function(e){return e.value===t.currentTarget.value}))[0]),m.chartOptions.set(m.analyticsOptions.get().chartOptions[0])},"change #lc-analytics-chart-options":function(t){t.preventDefault(),m.chartOptions.set(m.analyticsOptions.get().chartOptions.filter((function(e){return e.value===t.currentTarget.value}))[0])}})}

