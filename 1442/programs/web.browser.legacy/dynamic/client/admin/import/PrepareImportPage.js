function module(e,t,n){var r,a,u,o,i,c,l,s,m,f,p,d,h,E,g,_,k,b,v,C,x,I,S,P,w,T,y,F,R,B,D,L,M,U,H;n.link("@babel/runtime/regenerator",{default:function(e){r=e}},0),n.link("@babel/runtime/helpers/objectSpread2",{default:function(e){a=e}},1),n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){u=e}},2),n.link("@rocket.chat/fuselage",{Badge:function(e){o=e},Box:function(e){i=e},Button:function(e){c=e},ButtonGroup:function(e){l=e},CheckBox:function(e){s=e},Icon:function(e){m=e},Margins:function(e){f=e},Table:function(e){p=e},Tag:function(e){d=e},Throbber:function(e){h=e},Pagination:function(e){E=e},Tabs:function(e){g=e}},0),n.link("@rocket.chat/fuselage-hooks",{useDebouncedValue:function(e){_=e},useSafely:function(e){k=e}},1),n.link("react",{default:function(e){b=e},useEffect:function(e){v=e},useState:function(e){C=e},useMemo:function(e){x=e},useCallback:function(e){I=e}},2),n.link("underscore.string",{default:function(e){S=e}},3),n.link("meteor/meteor",{Meteor:function(e){P=e}},4),n.link("../../components/basic/Page",{default:function(e){w=e}},5),n.link("../../contexts/TranslationContext",{useTranslation:function(e){T=e}},6),n.link("../../../app/importer/lib/ImporterProgressStep",{ProgressStep:function(e){y=e},ImportWaitingStates:function(e){F=e},ImportFileReadyStates:function(e){R=e},ImportPreparingStartedStates:function(e){B=e},ImportingStartedStates:function(e){D=e},ImportingErrorStates:function(e){L=e}},7),n.link("./useErrorHandler",{useErrorHandler:function(e){M=e}},8),n.link("../../contexts/RouterContext",{useRoute:function(e){U=e}},9),n.link("../../contexts/ServerContext",{useEndpoint:function(e){H=e}},10);var O=function(e,t){return new Promise((function(n,r){var a=function(){e().then((function(e){t(e)?n(e):setTimeout(a,1e3)}),r)};a()}))};function j(e){var t=e.usersCount,n=e.users,r=e.setUsers,o=T(),i=C(0),c=u(i,2),l=c[0],m=c[1],f=C(25),h=u(f,2),g=h[0],_=h[1],k=I((function(e){var t=e.count,n=e.current,r=e.itemsPerPage;return o("Showing results %s - %s of %s",n+1,Math.min(n+r,t),t)}),[o]),v=I((function(){return o("Items_per_page:")}),[o]);return b.createElement(b.Fragment,null,b.createElement(p,null,b.createElement(p.Head,null,b.createElement(p.Row,null,b.createElement(p.Cell,{width:"x36"},b.createElement(s,{checked:t>0,indeterminate:t>0&&t!==n.length,onChange:function(){r((function(e){var n=e.some((function(e){var t=e.is_deleted,n=e.do_import;return t&&n})),r;return 0===t?e.map((function(e){return a({},e,{do_import:!0})})):n?e.map((function(e){return e.is_deleted?a({},e,{do_import:!1}):e})):e.map((function(e){return a({},e,{do_import:!1})}))}))}})),b.createElement(p.Cell,{is:"th"},o("Username")),b.createElement(p.Cell,{is:"th"},o("Email")),b.createElement(p.Cell,{is:"th"}))),b.createElement(p.Body,null,n.slice(l,l+g).map((function(e){return b.createElement(p.Row,{key:e.user_id},b.createElement(p.Cell,{width:"x36"},b.createElement(s,{checked:e.do_import,onChange:function(t){var n=t.currentTarget.checked;r((function(t){return t.map((function(t){return t===e?a({},t,{do_import:n}):t}))}))}})),b.createElement(p.Cell,null,e.username),b.createElement(p.Cell,null,e.email),b.createElement(p.Cell,{align:"end"},e.is_deleted&&b.createElement(d,{variant:"danger"},o("Deleted"))))})))),b.createElement(E,{current:l,itemsPerPage:g,count:n.length||0,onSetItemsPerPage:_,onSetCurrent:m,itemsPerPageLabel:v,showingResultsLabel:k}))}function G(e){var t=e.channels,n=e.channelsCount,r=e.setChannels,o=T(),i=C(0),c=u(i,2),l=c[0],m=c[1],f=C(25),h=u(f,2),g=h[0],_=h[1],k=I((function(e){var t=e.count,n=e.current,r=e.itemsPerPage;return o("Showing results %s - %s of %s",n+1,Math.min(n+r,t),t)}),[o]),v=I((function(){return o("Items_per_page:")}),[o]);return t.length&&b.createElement(b.Fragment,null,b.createElement(p,null,b.createElement(p.Head,null,b.createElement(p.Row,null,b.createElement(p.Cell,{width:"x36"},b.createElement(s,{checked:n>0,indeterminate:n>0&&n!==t.length,onChange:function(){r((function(e){var t=e.some((function(e){var t=e.is_archived,n=e.do_import;return t&&n})),r;return 0===n?e.map((function(e){return a({},e,{do_import:!0})})):t?e.map((function(e){return e.is_archived?a({},e,{do_import:!1}):e})):e.map((function(e){return a({},e,{do_import:!1})}))}))}})),b.createElement(p.Cell,{is:"th"},o("Name")),b.createElement(p.Cell,{is:"th",align:"end"}))),b.createElement(p.Body,null,t.slice(l,l+g).map((function(e){return b.createElement(p.Row,{key:e.channel_id},b.createElement(p.Cell,{width:"x36"},b.createElement(s,{checked:e.do_import,onChange:function(t){var n=t.currentTarget.checked;r((function(t){return t.map((function(t){return t===e?a({},t,{do_import:n}):t}))}))}})),b.createElement(p.Cell,null,e.name),b.createElement(p.Cell,{align:"end"},e.is_archived&&b.createElement(d,{variant:"danger"},o("Importer_Archived"))))})))),b.createElement(E,{current:l,itemsPerPage:g,itemsPerPageLabel:v,showingResultsLabel:k,count:t.length||0,onSetItemsPerPage:_,onSetCurrent:m}))}function N(){var e=T(),t=M(),n=k(C(!0)),s=u(n,2),p=s[0],d=s[1],E=k(C(null)),I=u(E,2),N=I[0],W=I[1],A=k(C(null)),V=u(A,2),q=V[0],z=V[1],J=k(C(0)),K=u(J,2),Q=K[0],X=K[1],Y=C([]),Z=u(Y,2),$=Z[0],ee=Z[1],te=C([]),ne=u(te,2),re=ne[0],ae=ne[1],ue=k(C(!1)),oe=u(ue,2),ie=oe[0],ce=oe[1],le=x((function(){return $.filter((function(e){var t;return e.do_import})).length}),[$]),se=x((function(){return re.filter((function(e){var t;return e.do_import})).length}),[re]),me=U("admin-import"),fe=U("admin-import-new"),pe=U("admin-import-progress"),de=H("GET","getImportFileData"),he=H("GET","getCurrentImportOperation"),Ee=H("POST","startImport");v((function(){var e=new P.Streamer("importers"),t=function(e){var t=e.rate;W(t)};return e.on("progress",t),function(){e.removeListener("progress",t)}}),[W]),v((function(){var n=function(){function n(){var n;return r.async(function(){function u(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,r.awrap(O(de,(function(e){return e&&!e.waiting})));case 3:if(n=u.sent){u.next=8;break}return t(e("Importer_not_setup")),me.push(),u.abrupt("return");case 8:if(!n.step){u.next=12;break}return t(e("Failed_To_Load_Import_Data")),me.push(),u.abrupt("return");case 12:X(n.message_count),ee(n.users.map((function(e){return a({},e,{do_import:!0})}))),ae(n.channels.map((function(e){return a({},e,{do_import:!0})}))),d(!1),W(null),u.next=23;break;case 19:u.prev=19,u.t0=u.catch(0),t(u.t0,e("Failed_To_Load_Import_Data")),me.push();case 23:case"end":return u.stop()}}return u}(),null,null,[[0,19]],Promise)}return n}(),u;(function(){function a(){var a,u;return r.async(function(){function o(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,r.awrap(O(he,(function(e){var t=e.operation;return t.valid&&!F.includes(t.status)})));case 3:if(a=o.sent,(u=a.operation).valid){o.next=8;break}return fe.push(),o.abrupt("return");case 8:if(!D.includes(u.status)){o.next=11;break}return pe.push(),o.abrupt("return");case 11:if(u.status!==y.USER_SELECTION&&!B.includes(u.status)&&!R.includes(u.status)){o.next=15;break}return z(u.status),n(),o.abrupt("return");case 15:if(!L.includes(u.status)){o.next=19;break}return t(e("Import_Operation_Failed")),me.push(),o.abrupt("return");case 19:if(u.status!==y.DONE){o.next=22;break}return me.push(),o.abrupt("return");case 22:t(e("Unknown_Import_State")),me.push(),o.next=30;break;case 26:o.prev=26,o.t0=o.catch(0),t(e("Failed_To_Load_Import_Data")),me.push();case 30:case"end":return o.stop()}}return o}(),null,null,[[0,26]],Promise)}return a})()()}),[he,de,t,me,pe,fe,X,d,W,z,e]);var ge=function(){me.push()},_e=function(){function n(){return r.async(function(){function n(n){for(;;)switch(n.prev=n.next){case 0:return ce(!0),n.prev=1,n.next=4,r.awrap(Ee({input:{users:$,channels:re}}));case 4:pe.push(),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(1),t(n.t0,e("Failed_To_Start_Import")),me.push();case 11:case"end":return n.stop()}}return n}(),null,null,[[1,7]],Promise)}return n}(),ke=C("users"),be=u(ke,2),ve=be[0],Ce=be[1],xe=x((function(){return function(e){return function(){return Ce(e)}}}),[]),Ie=_(q,100);return b.createElement(w,null,b.createElement(w.Header,{title:e("Importing_Data")},b.createElement(l,null,b.createElement(c,{ghost:!0,onClick:ge},b.createElement(m,{name:"back"})," ",e("Back_to_imports")),b.createElement(c,{primary:!0,disabled:ie,onClick:_e},e("Importer_Prepare_Start_Import")))),b.createElement(w.ScrollableContentWithShadow,null,b.createElement(i,{marginInline:"auto",marginBlock:"x24",width:"full",maxWidth:"590px"},b.createElement(i,{is:"h2",fontScale:"p2"},Ie&&e(Ie.replace("importer_","importer_status_"))),!p&&b.createElement(g,{flexShrink:0},b.createElement(g.Item,{disabled:0===le,selected:"users"===ve,onClick:xe("users")},e("Users")," ",b.createElement(o,{is:"span"},le)),b.createElement(g.Item,{selected:"channels"===ve,onClick:xe("channels")},e("Channels")," ",b.createElement(o,{is:"span"},se)),b.createElement(g.Item,{disabled:!0},e("Messages"),b.createElement(o,{is:"span"},Q))),b.createElement(f,{block:"x24"},p&&b.createElement(b.Fragment,null,N?b.createElement(i,{display:"flex",justifyContent:"center",fontScale:"p1"},b.createElement(i,{is:"progress",value:(10*N).toFixed(0),max:"1000",marginInlineEnd:"x24"}),b.createElement(i,{is:"span"},S.numberFormat(N,0),"%")):b.createElement(h,{justifyContent:"center"})),!p&&"users"===ve&&b.createElement(j,{usersCount:le,users:$,setUsers:ee}),!p&&"channels"===ve&&b.createElement(G,{channels:re,channelsCount:se,setChannels:ae})))))}n.exportDefault(N)}

