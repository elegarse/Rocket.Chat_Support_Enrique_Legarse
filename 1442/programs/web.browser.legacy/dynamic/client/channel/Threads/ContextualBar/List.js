function module(e,n,t){var r,i,o,u,a,l,c,s,d,f,m,p,g,h,k,x,v,E,_,b,T,w,S,C,I,D,M,y,U,z,R,B,G,L,A,N,O,P,F,H,$,j,V;function W(e){return function(n){var t=n.msg,r=n.username,i=n.replies,a=n.tcount,l=n.ts,c=u(n,["msg","username","replies","tcount","ts"]);return(s.createElement(e,o({replies:a,participants:i.length,username:r,msg:t,ts:l},c)))}}t.link("@babel/runtime/helpers/slicedToArray",{default:function(e){r=e}},0),t.link("@babel/runtime/helpers/objectSpread2",{default:function(e){i=e}},1),t.link("@babel/runtime/helpers/extends",{default:function(e){o=e}},2),t.link("@babel/runtime/helpers/objectWithoutProperties",{default:function(e){u=e}},3),t.export({withData:function(){return Z},normalizeThreadMessage:function(){return ne},ThreadList:function(){return te}}),t.link("meteor/mongo",{Mongo:function(e){a=e}},0),t.link("meteor/tracker",{Tracker:function(e){l=e}},1),t.link("underscore.string",{default:function(e){c=e}},2),t.link("react",{default:function(e){s=e},useCallback:function(e){d=e},useMemo:function(e){f=e},useState:function(e){m=e},useEffect:function(e){p=e},useRef:function(e){g=e}},3),t.link("@rocket.chat/fuselage",{Box:function(e){h=e},Icon:function(e){k=e},TextInput:function(e){x=e},Select:function(e){v=e},Margins:function(e){E=e},Callout:function(e){_=e}},4),t.link("react-window",{FixedSizeList:function(e){b=e}},5),t.link("react-window-infinite-loader",{default:function(e){T=e}},6),t.link("@rocket.chat/fuselage-hooks",{useDebouncedValue:function(e){w=e},useDebouncedState:function(e){S=e},useResizeObserver:function(e){C=e},useLocalStorage:function(e){I=e}},7),t.link("../../../components/basic/VerticalBar",{default:function(e){D=e}},8),t.link("../../../contexts/TranslationContext",{useTranslation:function(e){M=e}},9),t.link("../../../contexts/RouterContext",{useRoute:function(e){y=e},useCurrentRoute:function(e){U=e}},10),t.link("../../../../app/ui-utils/client",{call:function(e){z=e},renderMessageBody:function(e){R=e}},11),t.link("../../../contexts/UserContext",{useUserId:function(e){B=e},useUserSubscription:function(e){G=e}},12),t.link("../../../../app/models/client",{Messages:function(e){L=e}},13),t.link("../../../hooks/useEndpointDataExperimental",{useEndpointDataExperimental:function(e){A=e},ENDPOINT_STATES:function(e){N=e}},14),t.link("../../hooks/useUserRoom",{useUserRoom:function(e){O=e}},15),t.link("../../../contexts/SettingsContext",{useSetting:function(e){P=e}},16),t.link("../../../hooks/useTimeAgo",{useTimeAgo:function(e){F=e}},17),t.link("../../helpers/clickableItem",{clickableItem:function(e){H=e}},18),t.link("../../components/Message",{MessageSkeleton:function(e){$=e}},19),t.link("./components/Message",{default:function(e){j=e}},20),t.link("../../../../app/ui-utils/client/config",{getConfig:function(e){V=e}},21);var q=s.memo(W(H(j))),J=s.memo(H($)),K=parseInt(V("threadsListSize"))||25,Q=function(e){var n=e.msg,t=e.u,r=e.replies,o=e.mentions,u=e.tcount,a=e.ts,l=e._id,c=e.tlm,s=e.attachments;return i({},l&&{_id:l},{attachments:s,mentions:o,msg:n,u:t,replies:r,tcount:u,ts:new Date(a),tlm:new Date(c)})},X={tunread:1,tunreadUser:1,tunreadGroup:1},Y={t:1,name:1};function Z(e){return function(n){var t=n.rid,c=u(n,["rid"]),h=O(t,Y),k=G(t,X),x=B(),v=I("thread-list-type","all"),E=r(v,2),_=E[0],b=E[1],T=m(""),C=r(T,2),D=C[0],M=C[1],y=m(K),U=r(y,2),z=U[0],R=U[1],P=S([],100),F=r(P,2),H=F[0],$=F[1],j=g(new a.Collection(null)),V=g(),W=m({skip:0,count:K}),q=r(W,2),J=q[0],Z=q[1],ee=f((function(){return{rid:h._id,count:J.count,offset:J.skip,type:_,text:D}}),[h._id,J.skip,J.count,_,D]),ne=A("chat.getThreadsList",w(ee,400)),te=ne.data,re=ne.state,ie=ne.error,oe=d((function(e,n){return Z({skip:e,count:n-e}),new Promise((function(e){V.current=e}))}),[]);p((function(){return function(){return j.current.remove({},(function(){}))}}),[D,_]),p((function(){re===N.DONE&&te&&te.threads&&(te.threads.forEach((function(e){var n=e._id,t=u(e,["_id"]);j.current.upsert({_id:n},Q(t))})),V.current&&V.current(),R(te.total))}),[te,re]),p((function(){var e=L.find({rid:h._id,tcount:{$exists:!0},_hidden:{$ne:!0}}).observe({added:function(e){var n=e._id,t=u(e,["_id"]);j.current.upsert({_id:n},t)},changed:function(e){var n=e._id,t=u(e,["_id"]);j.current.update({_id:n},t)},removed:function(e){var n=e._id;j.current.remove(n)}});return function(){return e.stop()}}),[h._id]),p((function(){var e=l.autorun((function(){var e=i({},"subscribed"===_&&{replies:{$in:[x]}});$(j.current.find(e,{sort:{tlm:-1}}).fetch().map(Q))}));return function(){return e.stop()}}),[h._id,_,$,x]);var ue=d((function(e){Z({skip:0,count:K}),M(e.currentTarget.value)}),[]);return(s.createElement(e,o({},c,{unread:null==k?void 0:k.tunread,unreadUser:null==k?void 0:k.tunreadUser,unreadGroup:null==k?void 0:k.tunreadGroup,userId:x,error:ie,threads:H,total:z,loading:re===N.LOADING,loadMoreItems:oe,room:h,text:D,setText:ue,type:_,setType:b})))}}var ee=function(e){e.preventDefault(),e.stopPropagation(),z([!0,"true"].includes(e.currentTarget.dataset.following)?"unfollowMessage":"followMessage",{mid:e.currentTarget.dataset.id})},ne=function(e){var n=o({},e);if(n.msg)return R(n).replace(/<br\s?\\?>/g," ");if(n.attachments){var t=n.attachments.find((function(e){return e.title||e.description}));if(t&&t.description)return c.escapeHTML(t.description);if(t&&t.title)return c.escapeHTML(t.title)}};function te(e){var n=e.total,t=void 0===n?10:n,i=e.threads,u=void 0===i?[]:i,a=e.room,l=e.unread,c=void 0===l?[]:l,m=e.unreadUser,p=void 0===m?[]:m,w=e.unreadGroup,S=void 0===w?[]:w,I=e.type,z=e.setType,R=e.loadMoreItems,B=e.loading,G=e.onClose,L=e.error,A=e.userId,N=e.text,O=e.setText,H=P("UI_Use_Real_Name"),$=g(),j=M(),V=U(),W,Q=r(V,1)[0],X=y(Q),Y=d((function(e){var n=e.currentTarget.dataset.id;X.push({tab:"thread",context:n,rid:a._id,name:a.name})}),[a._id,a.name]),Z=F(),te=f((function(){return[["all",j("All")],["following",j("Following")],["unread",j("Unread")]]}),[]);$.current=u;var re=d(s.memo(function(){function e(e){var n=e.data,t=e.index,r=e.style;if(!n[t])return s.createElement(J,{style:r});var i=n[t],u=ne(i),a=i.u.name,l=void 0===a?i.u.username:a;return s.createElement(q,o({},i,{name:H?l:i.u.username,username:i.u.username,style:r,unread:c.includes(i._id),mention:p.includes(i._id),all:S.includes(i._id),following:i.replies&&i.replies.includes(A),"data-id":i._id,msg:u,t:j,formatDate:Z,handleFollowButton:ee,onClick:Y}))}return e}()),[c,p,S,H]),ie=d((function(e){return e<$.current.length}),[]),oe=C({debounceDelay:100}),ue=oe.ref,ae=oe.contentBoxSize,le=(ae=void 0===ae?{}:ae).inlineSize,ce=void 0===le?378:le,se=ae.blockSize,de=void 0===se?750:se;return s.createElement(D,null,s.createElement(D.Header,null,s.createElement(k,{name:"thread",size:"x20"}),s.createElement(h,{flexShrink:1,flexGrow:1,withTruncatedText:!0,mi:"x8"},j("Threads")),s.createElement(D.Close,{onClick:G})),s.createElement(D.Content,{paddingInline:0},s.createElement(h,{display:"flex",flexDirection:"row",p:"x24",borderBlockEndWidth:"x2",borderBlockEndStyle:"solid",borderBlockEndColor:"neutral-200",flexShrink:0},s.createElement(h,{display:"flex",flexDirection:"row",flexGrow:1,mi:"neg-x8"},s.createElement(E,{inline:"x8"},s.createElement(x,{placeholder:j("Search_Messages"),value:N,onChange:O,addon:s.createElement(k,{name:"magnifier",size:"x20"})}),s.createElement(v,{flexGrow:0,width:"110px",onChange:z,value:I,options:te})))),s.createElement(h,{flexGrow:1,flexShrink:1,ref:ue},L&&s.createElement(_,{mi:"x24",type:"danger"},L.toString()),0===t&&s.createElement(h,{p:"x24"},j("No_Threads")),s.createElement(T,{isItemLoaded:ie,itemCount:t,loadMoreItems:B?function(){}:R},(function(e){var n=e.onItemsRendered,r=e.ref;return(s.createElement(b,{height:de,width:ce,itemCount:t,itemData:u,itemSize:124,ref:r,minimumBatchSize:K,onItemsRendered:n},re))})))))}t.exportDefault(Z(te))}

