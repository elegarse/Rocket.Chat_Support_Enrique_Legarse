function module(e,n,t){var r,i,o,u,a,c,s,l,d,f,m,p,k,g,v,x,h,E,b,_,S,I,T,D,w,C,M,z,U,y,B,R,L,G,N,A,O,H;function P(e){return function(n){var t=n.msg,r=n.username,i=n.tcount,a=n.ts,c=u(n,["msg","username","tcount","ts"]);return(d.createElement(e,o({replies:i,username:r,msg:t,ts:a},c)))}}t.link("@babel/runtime/helpers/slicedToArray",{default:function(e){r=e}},0),t.link("@babel/runtime/helpers/objectSpread2",{default:function(e){i=e}},1),t.link("@babel/runtime/helpers/extends",{default:function(e){o=e}},2),t.link("@babel/runtime/helpers/objectWithoutProperties",{default:function(e){u=e}},3),t.export({withData:function(){return J},normalizeThreadMessage:function(){return K},DiscussionList:function(){return Q}}),t.link("meteor/mongo",{Mongo:function(e){a=e}},0),t.link("meteor/tracker",{Tracker:function(e){c=e}},1),t.link("meteor/kadira:flow-router",{FlowRouter:function(e){s=e}},2),t.link("underscore.string",{default:function(e){l=e}},3),t.link("react",{default:function(e){d=e},useCallback:function(e){f=e},useMemo:function(e){m=e},useState:function(e){p=e},useEffect:function(e){k=e},useRef:function(e){g=e}},4),t.link("@rocket.chat/fuselage",{Box:function(e){v=e},Icon:function(e){x=e},TextInput:function(e){h=e},Callout:function(e){E=e}},5),t.link("react-window",{FixedSizeList:function(e){b=e}},6),t.link("react-window-infinite-loader",{default:function(e){_=e}},7),t.link("@rocket.chat/fuselage-hooks",{useDebouncedValue:function(e){S=e},useDebouncedState:function(e){I=e},useResizeObserver:function(e){T=e}},8),t.link("../../../../app/ui-utils/client",{renderMessageBody:function(e){D=e}},9),t.link("../../../../app/ui-utils/client/config",{getConfig:function(e){w=e}},10),t.link("../../../../app/models/client",{Messages:function(e){C=e}},11),t.link("../../../components/basic/VerticalBar",{default:function(e){M=e}},12),t.link("../../../contexts/TranslationContext",{useTranslation:function(e){z=e}},13),t.link("../../../contexts/UserContext",{useUserId:function(e){U=e},useUserSubscription:function(e){y=e}},14),t.link("../../../hooks/useEndpointDataExperimental",{useEndpointDataExperimental:function(e){B=e},ENDPOINT_STATES:function(e){R=e}},15),t.link("../../../hooks/useTimeAgo",{useTimeAgo:function(e){L=e}},16),t.link("../../components/Message",{MessageSkeleton:function(e){G=e}},17),t.link("../../hooks/useUserRoom",{useUserRoom:function(e){N=e}},18),t.link("../../../contexts/SettingsContext",{useSetting:function(e){A=e}},19),t.link("./components/Message",{default:function(e){O=e}},20),t.link("../../helpers/clickableItem",{clickableItem:function(e){H=e}},21);var j=d.memo(P(H(O))),F=d.memo(H(G)),V=parseInt(w("discussionListSize"))||25,W=function(e){var n=e.msg,t=e.drid,r=e.u,o=e.dcount,u=e.mentions,a=e.tcount,c=e.ts,s=e._id,l=e.dlm,d=e.attachments,f=e.name;return i({},s&&{_id:s},{drid:t,attachments:d,name:f,mentions:u,msg:n,u:r,dcount:o,tcount:a,ts:new Date(c),dlm:new Date(l)})},$={tunread:1,tunreadUser:1,tunreadGroup:1},q={t:1,name:1};function J(e){return function(n){var t=n.rid,i=u(n,["rid"]),s=N(t,q),l=y(t,$),v=U(),x=p(""),h=r(x,2),E=h[0],b=h[1],_=p(V),T=r(_,2),D=T[0],w=T[1],M=I([],100),z=r(M,2),L=z[0],G=z[1],A=g(new a.Collection(null)),O=g(),H=p({skip:0,count:V}),P=r(H,2),j=P[0],F=P[1],J=m((function(){return{roomId:s._id,count:j.count,offset:j.skip,text:E}}),[s._id,j.skip,j.count,E]),K=B("chat.getDiscussions",S(J,400)),Q=K.data,X=K.state,Y=K.error,Z=f((function(e,n){return F({skip:e,count:n-e}),new Promise((function(e){O.current=e}))}),[]);k((function(){return function(){return A.current.remove({},(function(){}))}}),[E]),k((function(){X===R.DONE&&Q&&Q.messages&&(Q.messages.forEach((function(e){var n=e._id,t=u(e,["_id"]);A.current.upsert({_id:n},W(t))})),w(Q.total),O.current&&O.current())}),[Q,X]),k((function(){var e=C.find({rid:s._id,drid:{$exists:!0}}).observe({added:function(e){var n=e._id,t=u(e,["_id"]);A.current.upsert({_id:n},t)},changed:function(e){var n=e._id,t=u(e,["_id"]);A.current.update({_id:n},t)},removed:function(e){var n=e._id;A.current.remove(n)}});return function(){return e.stop()}}),[s._id]),k((function(){var e=c.autorun((function(){var e={};G(A.current.find(e,{sort:{tlm:-1}}).fetch().map(W))}));return function(){return e.stop()}}),[s._id,G,v]);var ee=f((function(e){F({skip:0,count:V}),b(e.currentTarget.value)}),[]);return(d.createElement(e,o({},i,{unread:null==l?void 0:l.tunread,unreadUser:null==l?void 0:l.tunreadUser,unreadGroup:null==l?void 0:l.tunreadGroup,userId:v,error:Y,discussions:L,total:D,loading:X===R.LOADING,loadMoreItems:Z,room:s,text:E,setText:ee})))}}var K=function(e){var n=o({},e);if(n.msg)return D(n).replace(/<br\s?\\?>/g," ");if(n.attachments){var t=n.attachments.find((function(e){return e.title||e.description}));if(t&&t.description)return l.escapeHTML(t.description);if(t&&t.title)return l.escapeHTML(t.title)}};function Q(e){var n=e.total,t=void 0===n?10:n,r=e.discussions,i=void 0===r?[]:r,u=e.loadMoreItems,a=e.loading,c=e.onClose,l=e.error,m=e.userId,p=e.text,k=e.setText,S=A("UI_Use_Real_Name"),I=g(),D=z(),w=f((function(e){var n=e.currentTarget.dataset.drid;s.goToRoomById(n)}),[]),C=L();I.current=i;var U=f(d.memo(function(){function e(e){var n=e.data,t=e.index,r=e.style;if(!n[t])return d.createElement(F,{style:r});var i=n[t],u=K(i),a=i.u.name,c=void 0===a?i.u.username:a;return d.createElement(j,o({},i,{name:S?c:i.u.username,username:i.u.username,style:r,following:i.replies&&i.replies.includes(m),"data-drid":i.drid,msg:u,t:D,formatDate:C,onClick:w}))}return e}()),[S]),y=f((function(e){return e<I.current.length}),[]),B=T(),R=B.ref,G=B.contentBoxSize,N=(G=void 0===G?{}:G).inlineSize,O=void 0===N?378:N,H=G.blockSize,P=void 0===H?750:H;return d.createElement(M,null,d.createElement(M.Header,null,d.createElement(M.Icon,{name:"discussion"}),d.createElement(v,{flexShrink:1,flexGrow:1,withTruncatedText:!0,mi:"x8"},D("Discussions")),d.createElement(M.Close,{onClick:c})),d.createElement(M.Content,{paddingInline:0},d.createElement(v,{display:"flex",flexDirection:"row",p:"x24",borderBlockEndWidth:"x2",borderBlockEndStyle:"solid",borderBlockEndColor:"neutral-200",flexShrink:0},d.createElement(h,{placeholder:D("Search_Messages"),value:p,onChange:k,addon:d.createElement(x,{name:"magnifier",size:"x20"})})),d.createElement(v,{flexGrow:1,flexShrink:1,ref:R},l&&d.createElement(E,{mi:"x24",type:"danger"},l.toString()),0===t&&d.createElement(v,{p:"x24"},D("No_Discussions_found")),d.createElement(_,{isItemLoaded:y,itemCount:t,loadMoreItems:a?function(){}:u},(function(e){var n=e.onItemsRendered,r=e.ref;return(d.createElement(b,{height:P,width:O,itemCount:t,itemData:i,itemSize:124,ref:r,minimumBatchSize:V,onItemsRendered:n},U))})))))}t.exportDefault(J(Q))}

